<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Image Analysis with Python and Napari: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Image Analysis with Python and Napari
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Image Analysis with Python and Napari
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Image Analysis with Python and Napari
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-opening-and-checking-an-image.html">1. Opening and Checking an Image</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-applying-filters.html">2. Applying Filters</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-thresholding-and-segmentation.html">3. Thresholding and Segmentation</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-measurements.html">4. Measurements</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-napari.html">5. Introduction to Napari</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-opening-and-checking-an-image"><p>Content from <a href="01-opening-and-checking-an-image.html">Opening and Checking an Image</a></p>
<hr>
<p>Last updated on 2024-06-13 |

        <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/edit/main/episodes/01-opening-and-checking-an-image.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I open an image file in Python for processing?</li>
<li>How can I explore an image once it’s open?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Open an image with skimage</li>
<li>Discuss how to open proprietary image formats</li>
<li>Display an opened image to the screen</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="opening-an-image">Opening an image<a class="anchor" aria-label="anchor" href="#opening-an-image"></a>
<a class="anchor" aria-label="anchor" href="#opening-an-image"></a>
</h2>
<hr class="half-width">
<p>At its core, an image is a multidimensional array of numbers, and as
such can be opened by programs and libraries designed for working with
this kind of data. For Python, one such library is scikit-image. This
library provides a function called <code>imread</code> that we can use
to load an image into memory. In a new notebook cell:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">from</span> skimage.io <span class="im">import</span> imread</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>image <span class="op">=</span> imread(<span class="st">'data/FluorescentCells_3channel.tif'</span>)</span></code></pre>
</div>
<p>If you saved your images to a different location, you will need to
change the file path provided to imread accordingly. Paths will be
relative to the location of the .ipynb notebook file.</p>
<p>To view things in Python, usually we use <code>print()</code>.
However if we try to print this image to the Jupyter console, instead of
getting the image we get something that may be unexpected:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&gt; print(image)
array([[[ 16,  50,   0],
        [ 15,  44,   0],
        [ 18,  40,   1],
        ...,
        [  1,  15,   2],
        [  1,  15,   2],
        [  1,  15,   2]]], dtype=uint8)</code></pre>
</div>
<p>Python has loaded and stored the image as a Numpy <code>array</code>
object of numbers, and <code>print()</code> displays the string
representation or textual form of the data passed to it, which is why we
get a matrix of numbers printed to the screen.</p>
<p>If we want to see what the image looks like, we need tell Python to
display it as an image. We can do this with the <code>imshow</code>
function from skimage, which can be imported and called in a similar way
to <code>imread</code>:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">from</span> skimage.io <span class="im">import</span> imshow</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>imshow(image)</span></code></pre>
</div>
<p>You should see the image displayed below the current cell:</p>
<figure><img src="fig/1_1_imshow.jpg" alt="Displaying an image with imshow" class="figure mx-auto d-block"></figure><p>Since images are multi-dimensional arrays of numbers, we can apply
statistical functions to them and extract some basic metrics. Numpy
arrays have methods for several of these already, including the image’s
shape, data type and minimum/maximum values:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="bu">print</span>(image.shape, image.dtype, image.<span class="bu">min</span>(), image.<span class="bu">max</span>())</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>(<span class="dv">512</span>, <span class="dv">512</span>, <span class="dv">3</span>) uint8 <span class="dv">0</span> <span class="dv">255</span></span></code></pre>
</div>
<p>This shows that the image has a data type of uint8, it contains
values between 0 and 255 and that it is in three dimensions. We can
reasonably infer that the two <code>512</code> numbers are the X and Y
axes. The third axis in most cases will correspond to the number of
channels.</p>
<p>We can select a single channel by <strong>indexing</strong> the
array:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>imshow(image[:, :, <span class="dv">0</span>])</span></code></pre>
</div>
<p>Here, we select the entire X and Y coordinates using <code>:</code>
with no numbers around them, and the first channel (remember that Python
counts from 0).</p>
<div id="exercise-1-loading-an-image" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-1-loading-an-image" class="callout-inner">
<h3 class="callout-title">Exercise 1: Loading an image<a class="anchor" aria-label="anchor" href="#exercise-1-loading-an-image"></a>
</h3>
<div class="callout-content">
<p>Load the test image ‘FluorescentCells_3channel.tif’:</p>
<ul>
<li>Try the same as the example above, but loading one of the other
channels</li>
<li>Save your single channel to a variable. What happens if you run
<code>imshow</code> on <code>channel.T</code>?</li>
<li>How can we select part of the image, i.e. crop it? Remember that to
do this, we need to select a subset of the X and/or Y axes.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Other channels can be loaded with <code>image[:, :, x]</code>, where
<code>image</code> is the variable the image is saved to and
<code>x</code> is the index of a channel to retrieve.</p>
<p>Next we can use <code>.T</code> to return a
<strong>transposed</strong> version of the image. Running
<code>imshow()</code> on this results in an image that is flipped
90°:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>channel <span class="op">=</span> image[:, :, <span class="dv">1</span>]</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>imshow(channel.T)</span></code></pre>
</div>
<figure><img src="fig/1_2_transpose.jpg" alt="Transposed image" class="figure mx-auto d-block"></figure><p>Remember that Numpy arrays can be sliced and indexed the same way as
lists, strings and tuples. Up to this point we’ve been using
<code>:</code> to select an entire axis, but we can give it start and
end bounds to select part of the X and Y axes, like:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>image[:<span class="dv">256</span>, <span class="dv">128</span>:<span class="dv">384</span>, <span class="dv">1</span>]</span></code></pre>
</div>
<figure><img src="fig/1_3_2d_slice.jpg" alt="2-dimensional slice" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>Numpy arrays have many more methods available for checking them. Here
are just a few to start with:</p>
<div class="section level3">
<h3 id="pixel-value-statistics">Pixel value statistics<a class="anchor" aria-label="anchor" href="#pixel-value-statistics"></a>
</h3>
<ul>
<li><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.mean.html" class="external-link"><code>image.mean()</code></a></li>
<li><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.min.html" class="external-link"><code>image.min()</code></a></li>
<li><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.max.html" class="external-link"><code>image.max()</code></a></li>
<li><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.std.html" class="external-link"><code>image.std()</code></a></li>
</ul>
</div>
<div class="section level3">
<h3 id="image-size">Image size<a class="anchor" aria-label="anchor" href="#image-size"></a>
</h3>
<p><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.shape.html" class="external-link"><code>image.shape</code></a></p>
</div>
<div class="section level3">
<h3 id="object-size">Object size<a class="anchor" aria-label="anchor" href="#object-size"></a>
</h3>
<p><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.nbytes.html" class="external-link"><code>image.nbytes</code></a></p>
<div id="exercise-2-memory-check" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-2-memory-check" class="callout-inner">
<h3 class="callout-title">Exercise 2: Memory check<a class="anchor" aria-label="anchor" href="#exercise-2-memory-check"></a>
</h3>
<div class="callout-content">
<p>How much memory did it take to load
FluorescentCells_3channel.tif?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Running <code>image.nbytes</code> shows that it takes up 786432
bytes, or ~786 kilobytes, or ~0.7 megabytes.</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="displaying-one-channel-at-a-time">Displaying one channel at a time<a class="anchor" aria-label="anchor" href="#displaying-one-channel-at-a-time"></a>
<a class="anchor" aria-label="anchor" href="#displaying-one-channel-at-a-time"></a>
</h2>
<hr class="half-width">
<p>We’ve seen from exercise 1 that we can view single channels by
indexing the array. We can show all channels together using a matplotlib
figure:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>matplotlib.pyplot.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))  <span class="co"># figure size, in inches</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>nchannels <span class="op">=</span> image.shape[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(nchannels):</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    matplotlib.pyplot.subplot(<span class="dv">1</span>, nchannels, i<span class="op">+</span><span class="dv">1</span>)  <span class="co"># 1-indexing in subplots</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    matplotlib.pyplot.imshow(image[:, :, i])</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    matplotlib.pyplot.title(<span class="st">'Channel </span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> i)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    matplotlib.pyplot.axis(<span class="va">False</span>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>matplotlib.pyplot.show()</span></code></pre>
</div>
<figure><img src="fig/1_4_all_channels.jpg" alt="All image channels" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="histograms">Histograms<a class="anchor" aria-label="anchor" href="#histograms"></a>
<a class="anchor" aria-label="anchor" href="#histograms"></a>
</h2>
<hr class="half-width">
<p>Another common metric to look at in an image is its histogram. This
can be plotted by flattening the image and passing it to matplotlib:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>matplotlib.pyplot.hist(image.flatten())</span></code></pre>
</div>
<p>We need <code>flatten()</code> to condense the pixel values from two
dimensions into one, since <code>hist()</code> expects a one-dimensional
array of values. <code>hist()</code> also takes an argument,
<code>bins</code>, which will change how many bins the data is split
into.</p>
<div id="exercise-3-histograms" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-3-histograms" class="callout-inner">
<h3 class="callout-title">Exercise 3: Histograms<a class="anchor" aria-label="anchor" href="#exercise-3-histograms"></a>
</h3>
<div class="callout-content">
<p>Combine the usage of <code>matplotlib.pyplot.hist()</code> and
<code>matplotlib.pyplot.figure()</code> introduced above above and plot
a histogram of each of the three channels in
FluorescentCells_3channel.tif.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>Multiple histograms can be plotted with:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>matplotlib.pyplot.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))  <span class="co"># figsize is width and height, in inches</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>nchannels <span class="op">=</span> image.shape[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(nchannels):</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>    matplotlib.pyplot.subplot(<span class="dv">1</span>, nchannels, i<span class="op">+</span><span class="dv">1</span>)  <span class="co"># 1-indexing in subplots</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    matplotlib.pyplot.hist(image[:, :, i].flatten(), bins<span class="op">=</span><span class="dv">255</span>)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    matplotlib.pyplot.title(<span class="st">'Channel </span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> i)</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>    matplotlib.pyplot.axis(<span class="va">False</span>)</span></code></pre>
</div>
<figure><img src="fig/1_5_histograms.jpg" alt="All image channels" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="proprietary-formats">Proprietary formats<a class="anchor" aria-label="anchor" href="#proprietary-formats"></a>
<a class="anchor" aria-label="anchor" href="#proprietary-formats"></a>
</h2>
<hr class="half-width">
<p>Images can come in many formats, but for many of the common ones such
as TIFF, PNG and BMP, skimage is smart enough to know how to read each
one.</p>
<p>Some image formats are associated with specific instruments or
equipment and require specialised packages to open. Depending on your
system, these may already be available via <code>import</code> the same
as any other Python package. If not, then these should be installed into
whatever Python instance you are using.</p>
<p>If using JupyterHub or JupyterLab, go to ‘New’ -&gt; ‘Terminal’. This
will open a shell session in a new browser tab, where you can run
<code>pip install</code> commands.</p>
<div class="section level3">
<h3 id="carl-zeiss--czi">Carl Zeiss .czi<a class="anchor" aria-label="anchor" href="#carl-zeiss--czi"></a>
</h3>
<p>Images in .czi format can be opened with the <code>czifile</code>
library. In the Terminal you opened above:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">$</span> pip install czifile</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="nikon--nd2">Nikon .nd2<a class="anchor" aria-label="anchor" href="#nikon--nd2"></a>
</h3>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">$</span> pip install nd2</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="imaris--ims">Imaris .ims<a class="anchor" aria-label="anchor" href="#imaris--ims"></a>
</h3>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">$</span> pip install imaris-ims-file-reader</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="leica--lif">Leica .lif<a class="anchor" aria-label="anchor" href="#leica--lif"></a>
</h3>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">$</span> pip install readlif</span></code></pre>
</div>
<div id="exercise-4-proprietary-formats" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-4-proprietary-formats" class="callout-inner">
<h3 class="callout-title">Exercise 4: Proprietary formats<a class="anchor" aria-label="anchor" href="#exercise-4-proprietary-formats"></a>
</h3>
<div class="callout-content">
<p>Load the <a href="https://pypi.org/project/nd2" class="external-link">nd2</a> package and
use it to read the test file ‘Ersi_organoid_WT2.nd2’. Install it if you
need to.</p>
<p>What axes are present in the image? Which look most likely to be the
X and Y axes? Use <code>imshow</code> to display a single frame from the
image.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>If not already present, the nd2 package can be installed with
<code>pip install nd2</code>. According to its documentation and page on
PyPI, it has an <code>imread</code> function that works in a similar way
to the one in skimage:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>image <span class="op">=</span> nd2.imread(<span class="st">'data/Ersi_organoid_WT2.nd2'</span>)</span></code></pre>
</div>
<p><code>img.shape</code> shows that there are four axes,
<code>(27, 3, 512, 512)</code>. The latter two numbers look like the X
and Y axes, while the second number looks like a number of channels as
with the first example image. We’ll get to the first number in a moment.
For now, we can show a single frame with:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>imshow(image[<span class="dv">0</span>, <span class="dv">0</span>, :, :])</span></code></pre>
</div>
<figure><img src="fig/1_6_nd2_image_frame.jpg" alt="ND2 image" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="channels-series-and-stacks">Channels, series and stacks<a class="anchor" aria-label="anchor" href="#channels-series-and-stacks"></a>
<a class="anchor" aria-label="anchor" href="#channels-series-and-stacks"></a>
</h2>
<hr class="half-width">
<p>In the exercise above, we encountered an image with four axes. We
could guess at what the latter three are, but the first one could be a
couple of things. It could correspond to a timepoint (i.e. the image is
a collection of 27 frames taken at different points in time), or it
could be a Z axis - images with a Z axis are often known as a
<strong>Z-stack</strong>.</p>
<p>There is no clear indication from looking directly at the data
though, and it’s often necessary to consult documentation or metadata
for the image. You may also notice that here the X/Y axes are the latter
two numbers, but in the first example above, the X/Y axes were the first
two. This demonstrates the diversity and general lack of consistency
with image files, and it’s necessary to consider carefully the image’s
format before processing it.</p>
</section><section><h2 class="section-heading" id="altering-the-lookup-table">Altering the lookup table<a class="anchor" aria-label="anchor" href="#altering-the-lookup-table"></a>
<a class="anchor" aria-label="anchor" href="#altering-the-lookup-table"></a>
</h2>
<hr class="half-width">
<p>Now that we’ve been able to open an image, we can start to explore it
and display it in different ways.</p>
<p>The <code>imshow()</code> function can take extra arguments in
addition to the image to display. One of these is called
<code>cmap</code>, standing for ‘colour map’, which can apply alternate
lookup tables:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>imshow(image, cmap<span class="op">=</span><span class="st">'gray'</span>)</span></code></pre>
</div>
<p>Skimage uses lookup tables from the plotting library matplotlib. A
list of available tables can be obtained with:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> colormaps</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">sorted</span>(matplotlib.colormaps))</span></code></pre>
</div>
<div id="exercise-5-lookup-tables" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-5-lookup-tables" class="callout-inner">
<h3 class="callout-title">Exercise 5: Lookup tables<a class="anchor" aria-label="anchor" href="#exercise-5-lookup-tables"></a>
</h3>
<div class="callout-content">
<p>Display each of the three channels of FluorescentCells_3channel.tif
side by side in a matplotlib figure, each in a different colour using
<code>cmap=</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>There will be many ways to do this (and many colour maps to choose
from!), but here is one possible solution:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>matplotlib.pyplot.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>colours <span class="op">=</span> (<span class="st">'Blues'</span>, <span class="st">'Oranges'</span>, <span class="st">'YlOrBr'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>matplotlib.pyplot.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>imshow(image[:, :, <span class="dv">0</span>], cmap<span class="op">=</span><span class="st">'Blues'</span>)</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>matplotlib.pyplot.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>imshow(image[:, :, <span class="dv">1</span>], cmap<span class="op">=</span><span class="st">'Oranges'</span>)</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>matplotlib.pyplot.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>imshow(image[:, :, <span class="dv">2</span>], cmap<span class="op">=</span><span class="st">'YlOrBr'</span>)</span></code></pre>
</div>
<figure><img src="fig/1_7_colormaps.jpg" alt="ND2 image" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="exercise-6-rgb-images" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-6-rgb-images" class="callout-inner">
<h3 class="callout-title">Exercise 6: RGB images<a class="anchor" aria-label="anchor" href="#exercise-6-rgb-images"></a>
</h3>
<div class="callout-content">
<p>Load hela-cells_rgb.tif and try displaying it with different lookup
tables. What results do you get, and why?</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Show me the solution </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<p>The image will always look the same regardless of the lookup table
used. In this case, this is because hela-cells_rgb.tif is an RGB image,
and the lookup table will be ignored since the colours are explicitly
encoded into the pixel values.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="other-notes">Other notes<a class="anchor" aria-label="anchor" href="#other-notes"></a>
<a class="anchor" aria-label="anchor" href="#other-notes"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="rearranging-channels">Rearranging channels<a class="anchor" aria-label="anchor" href="#rearranging-channels"></a>
</h3>
<p>You may find yourself in a situation where the arrangement of
dimensions in your image is incorrect for the processing you wish to
perform on it - maybe a function requires that an image be oriented in a
particular way. This is where it’s useful to be able to rearrange the
dimensions of an image. To do this, we can use Numpy’s
<code>moveaxis</code> function:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="im">import</span> numpy</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>image <span class="op">=</span> imread(<span class="st">'data/maize-seedlings.tif'</span>)</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="bu">print</span>(image.shape)</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>(<span class="dv">800</span>, <span class="dv">800</span>, <span class="dv">3</span>)</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>rearranged_image <span class="op">=</span> numpy.moveaxis(image, <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="bu">print</span>(rearranged_image.shape)</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>(<span class="dv">3</span>, <span class="dv">800</span>, <span class="dv">800</span>)</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="bu">print</span>(image.shape)</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>(<span class="dv">800</span>, <span class="dv">800</span>, <span class="dv">3</span>)</span></code></pre>
</div>
<p>We can see that calling <code>moveaxis</code> on an array gives us a
rearranged version of the array given to it - the channel axis that was
at the end is now at the front. However, we can see that the original
copy of the image is unchanged. This is because by default,
<code>moveaxis</code> returns a rearranged <strong>copy</strong> of the
image.</p>
<p>The arguments supplied are:</p>
<ul>
<li>The image or array</li>
<li>The current position of the dimension to move</li>
<li>The position to move that dimension to</li>
</ul>
<p>In this case, we are moving the dimension at position -1 (i.e. the
one at the end) to position 0 (the start).</p>
</div>
<div class="section level3">
<h3 id="pixel-size">Pixel size<a class="anchor" aria-label="anchor" href="#pixel-size"></a>
</h3>
<p>Pixels are an approximation of an object - knowing that something is
50 pixels long and 50 pixels wide doesn’t tell us anything about its
actual size. To make any real-world measurements on the image, we need
the image’s <strong>pixel size</strong>.</p>
<p>To get this, it is necessary to read the image’s
<strong>metadata</strong>. For this we need a different library,
imageio. There are a couple of different places we can look:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">m</span> = imageio.v3.immeta<span class="er">(</span><span class="st">'path/to/image.png'</span><span class="kw">)</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="ex">p</span> = imageio.v3.improps<span class="er">(</span><span class="st">'path/to/image.png'</span><span class="kw">)</span></span></code></pre>
</div>
<p><code>immeta()</code> gives us a dict including the key ‘unit’, and
<code>improps</code> gives an object with the property ‘spacing’.
However Peter Bankhead notes that <a href="https://bioimagebook.github.io/chapters/1-concepts/5-pixel_size/python.html#imageio" class="external-link">these
numbers can be misleading</a> and require interpretation and
cross-checking.</p>
<p>The unit may be returned as escaped Unicode:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="st">'unit'</span><span class="ex">:</span> <span class="st">'\\u00B5m'</span></span></code></pre>
</div>
<p>This can be un-escaped with:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> m<span class="pp">[</span><span class="st">'unit'</span><span class="pp">]</span>.encode<span class="kw">()</span><span class="ex">.decode</span><span class="er">(</span><span class="st">'unicode-escape'</span><span class="kw">)</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="ex">μm</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Common image formats can usually all be loaded in the same way</li>
<li>Specialised proprietary formats may require specialised
libraries</li>
<li>Histograms and basic metrics can tell a great deal about the
encoding of the image</li>
<li>This is often important when considering how to analyse the
image</li>
<li>Lookup tables can change how a single-channel image is rendered</li>
<li>An RGB image contains 3-channels for red, green and blue</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-02-applying-filters"><p>Content from <a href="02-applying-filters.html">Applying Filters</a></p>
<hr>
<p>Last updated on 2024-06-13 |

        <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/edit/main/episodes/02-applying-filters.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I make it possible to isolate features in my images?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Apply mean and Gaussian filters to an image</li>
<li>Select one of these filtered images to use for processing in
subsequent chapters</li>
<li>Todo: Discuss Difference of Gaussian and Laplacian of Gaussian
algorithms</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="filters">Filters<a class="anchor" aria-label="anchor" href="#filters"></a>
<a class="anchor" aria-label="anchor" href="#filters"></a>
</h2>
<hr class="half-width">
<p>Images often need to have noise removed in order for the results of
further processing to be meaningful. There are many smoothing filters
available, each with their own advantages depending on the situation and
the image in question. Here are two to get started:</p>
<ul>
<li><a href="https://scikit-image.org/docs/stable/api/skimage.filters.rank.html#skimage.filters.rank.mean" class="external-link">mean
filter</a></li>
<li><a href="https://scikit-image.org/docs/stable/api/skimage.filters.html#skimage.filters.Gaussian" class="external-link">Gaussian
filter</a></li>
</ul>
<p>A mean filter will, for each pixel:</p>
<ul>
<li>Create a kernel of pixels around it, in a size/shape of the user’s
choosing</li>
<li>Take the mean of all pixels within this kernel</li>
<li>Assign this new value to the pixel</li>
</ul>
<p>The kernel in this case can be considered analogous to a
2-dimensional sliding window.</p>
<p>A Gaussian filter is similar to a mean filter, except that pixels
near the centre of the kernel will have a greater effect on the
result.</p>
<div id="exercise-7-applying-filters" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-7-applying-filters" class="callout-inner">
<h3 class="callout-title">Exercise 7: Applying filters<a class="anchor" aria-label="anchor" href="#exercise-7-applying-filters"></a>
</h3>
<div class="callout-content">
<p>Look at the documentation pages for the mean and Gaussian filters
above. Load the last channel of FluorescentCells_3channel.tif containing
the nuclei, and build a figure displaying it in each of the following
forms:</p>
<ul>
<li>original image</li>
<li>5x5 square mean filter applied</li>
<li>15x15 square mean filter</li>
<li>Gaussian filter of sigma = 3</li>
<li>Gaussian filter of sigma = 5</li>
</ul>
<p>How do the different methods compare?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> skimage</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>img <span class="op">=</span> imread(<span class="st">'data/FluorescentCells_3channel.tif'</span>)[:, :, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">12</span>))</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>plt.imshow(img)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>plt.title(<span class="st">'Original'</span>)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>mean5x5 <span class="op">=</span> skimage.filters.rank.mean(img, skimage.morphology.square(<span class="dv">5</span>))</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>plt.imshow(mean5x5)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>plt.title(<span class="st">'5x5 mean filter'</span>)</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>mean15x15 <span class="op">=</span> skimage.filters.rank.mean(img, skimage.morphology.square(<span class="dv">15</span>))</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>plt.imshow(mean15x15)</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>plt.title(<span class="st">'15 x 15 mean filter'</span>)</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>gauss3 <span class="op">=</span> skimage.filters.gaussian(img, <span class="dv">3</span>)</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>plt.imshow(gauss3)</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>plt.title(<span class="st">'Gaussian blur, σ=3'</span>)</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>gauss5 <span class="op">=</span> skimage.filters.gaussian(img, <span class="dv">5</span>)</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>plt.imshow(gauss5)</span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>plt.title(<span class="st">'Gaussian blur, σ=5'</span>)</span></code></pre>
</div>
<figure><img src="fig/2_1_filters.jpg" alt="Filters" class="figure mx-auto d-block"></figure><p>Larger mean kernels and sigma values will result in a greater
smoothing effect and a more blurred image.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="removing-the-background">Removing the background<a class="anchor" aria-label="anchor" href="#removing-the-background"></a>
<a class="anchor" aria-label="anchor" href="#removing-the-background"></a>
</h2>
<hr class="half-width">
<p>Sometimes when we’re trying to isolate the foreground from the
background, the two are not entirely distinct from each other. In cases
like this, a rolling ball algorithm can be applied. The rolling ball
estimates the background intensity of an image by using the pixel values
to translate the image into a height map, and then rolling a ball of a
given radius across it. Additional information on how it works can be
found <a href="https://www.researchgate.net/figure/Schematic-diagram-of-background-subtraction-by-the-rolling-ball-method-the-histogram_fig3_319985119" class="external-link">here</a>.</p>
<div id="exercise-8-rolling-ball-background-intensity" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-8-rolling-ball-background-intensity" class="callout-inner">
<h3 class="callout-title">Exercise 8: Rolling ball background intensity<a class="anchor" aria-label="anchor" href="#exercise-8-rolling-ball-background-intensity"></a>
</h3>
<div class="callout-content">
<p>Look at the <a href="https://scikit-image.org/docs/stable/auto_examples/segmentation/plot_rolling_ball.html" class="external-link">scikit-image
documentation</a> on the rolling ball filter. Load the example image
<code>skimage.data.coins</code> and display:</p>
<ul>
<li>the original image</li>
<li>image with a rolling ball of radius 100 applied</li>
<li>image with a rolling ball of radius 50 applied</li>
<li>the image with the radius=50 rolling ball subtracted from it</li>
</ul>
<p>How long does it take to compute?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Compute time can be found using Python’s datetime library:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="im">import</span> skimage</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>img <span class="op">=</span> skimage.data.coins()</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>t0 <span class="op">=</span> datetime.datetime.now()</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>plt.imshow(img)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>t1 <span class="op">=</span> datetime.datetime.now()</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>plt.title(<span class="st">'Original'</span>)</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>rolling_ball_100 <span class="op">=</span> skimage.restoration.rolling_ball(img, radius<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>plt.imshow(rolling_ball_100)</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>t2 <span class="op">=</span> datetime.datetime.now()</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>plt.title(<span class="st">'Rolling ball, r=100'</span>)</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>rolling_ball_50 <span class="op">=</span> skimage.restoration.rolling_ball(img, radius<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>plt.imshow(rolling_ball_50)</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>t3 <span class="op">=</span> datetime.datetime.now()</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>plt.title(<span class="st">'Rolling ball, r=50'</span>)</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>plt.imshow(img <span class="op">-</span> rolling_ball_50)</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>plt.title(<span class="st">'Original - rolling ball r50'</span>)</span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>plt.show()</span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Original image:'</span>, t1 <span class="op">-</span> t0)</span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Rolling ball 100: '</span>, t2 <span class="op">-</span> t1)</span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Rolling ball 50:'</span>, t3 <span class="op">-</span> t2)</span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Total:'</span>, t3 <span class="op">-</span> t0)</span></code></pre>
</div>
<figure><img src="fig/2_2_rolling_ball.jpg" alt="Rolling ball" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="dogs-and-logs">Dogs and logs<a class="anchor" aria-label="anchor" href="#dogs-and-logs"></a>
<a class="anchor" aria-label="anchor" href="#dogs-and-logs"></a>
</h2>
<hr class="half-width">
<p>Difference of Gaussian (DoG) and Laplacian of Gaussian (LoG) are
algorithms that build on the Gaussian filter.</p>
<p>In a <a href="https://scikit-image.org/docs/stable/api/skimage.filters.html#skimage.filters.difference_of_gaussians" class="external-link">Difference
of Gaussian</a>, two Gaussian filters are taken of the image, each with
a different sigma value. The larger filter is then subtracted from the
first to give an image where image features are effectively highlighted
by an area of high contrast.</p>
<p>In a Laplacian of Gaussian, a Gaussian-filtered image is supplied to
a <a href="https://scikit-image.org/docs/stable/api/skimage.filters.html#skimage.filters.laplace" class="external-link">Laplace</a>
filter. This eliminates the need to manually select two sigma values as
with Difference of Gaussian.</p>
<div id="exercise-9-dogs-and-logs" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-9-dogs-and-logs" class="callout-inner">
<h3 class="callout-title">Exercise 9: Dogs and logs<a class="anchor" aria-label="anchor" href="#exercise-9-dogs-and-logs"></a>
</h3>
<div class="callout-content">
<p>Load the image ‘Ersi_organoid_WT2.nd2’ and select the end channel of
the 16th frame, i.e. <code>img[15, 2, :, :]</code>. Display a figure
of:</p>
<ul>
<li>The original image</li>
<li>Image with a Difference of Gaussians applied with sigma values 2 and
4</li>
<li>Image with a Laplacian of Gaussians applied. Note that the Laplace
filter linked above does not perform the Gaussian filter for you.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>imshow(img[<span class="dv">15</span>, <span class="dv">2</span>, :, :])</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>imshow(skimage.filters.difference_of_gaussians(img[<span class="dv">15</span>, <span class="dv">2</span>, :, :], <span class="dv">2</span>, <span class="dv">4</span>))</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>imshow(skimage.filters.laplace(img[<span class="dv">15</span>, <span class="dv">2</span>, :, :]))</span></code></pre>
</div>
<figure><img src="fig/2_3_dogs_and_logs.jpg" alt="Dogs and logs" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="exercise-10-choosing-a-filter" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="exercise-10-choosing-a-filter" class="callout-inner">
<h3 class="callout-title">Exercise 10: Choosing a filter<a class="anchor" aria-label="anchor" href="#exercise-10-choosing-a-filter"></a>
</h3>
<div class="callout-content">
<p>Look at the images you produced in exercises 7 and 9, and select one
to use in subsequent chapters for thresholding and segmentation!</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>There are many ways of smoothing an image</li>
<li>Different methods will perform better in different situations</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-03-thresholding-and-segmentation"><p>Content from <a href="03-thresholding-and-segmentation.html">Thresholding and Segmentation</a></p>
<hr>
<p>Last updated on 2024-04-29 |

        <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/edit/main/episodes/03-thresholding-and-segmentation.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I isolate features of interest in my image?</li>
<li>How can I uniquely label features once I’ve found them?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Apply various thresholds an image</li>
<li>Quantify features of interest in an image</li>
<li>Demonstrate how to deal with edge cases like features stuck
together</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>These exercises will make use of the image you decided to use in
exercise 10.</p>
<section><h2 class="section-heading" id="thresholding">Thresholding<a class="anchor" aria-label="anchor" href="#thresholding"></a>
<a class="anchor" aria-label="anchor" href="#thresholding"></a>
</h2>
<hr class="half-width">
<p>Thresholding consists of converting an image into binary form
(i.e. <strong>binarising</strong> it), where each pixel value is
converted to either 0 or 1 depending on whether it exceeds a given
threshold.</p>
<p>We can binarise an image with a given threshold by applying the
<code>&gt;</code> operator to it. It’s common practice to smooth the
image first, e.g. with a Gaussian filter:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">img</span> = skimage.filters.gaussian<span class="er">(</span><span class="fu">skimage.data.cell()</span><span class="kw">)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">print</span><span class="er">(</span><span class="fu">img.min()</span><span class="ex">,</span> img.max<span class="er">(</span><span class="kw">)</span><span class="ex">,</span> img.dtype<span class="kw">)</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="ex">plt.subplot</span><span class="er">(</span><span class="ex">1,</span> 2, 1<span class="kw">)</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="ex">plt.imshow</span><span class="er">(</span><span class="ex">img</span><span class="kw">)</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="ex">plt.title</span><span class="er">(</span><span class="st">'Gaussian filter'</span><span class="kw">)</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="ex">plt.subplot</span><span class="er">(</span><span class="ex">1,</span> 2, 2<span class="kw">)</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="ex">binary_img</span> = img <span class="op">&gt;</span> 0.5</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="ex">plt.imshow</span><span class="er">(</span><span class="ex">binary_img</span><span class="kw">)</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="ex">plt.title</span><span class="er">(</span><span class="st">'Threshold &gt; 0.5'</span><span class="kw">)</span></span></code></pre>
</div>
<figure><img src="fig/3_1_threshold.jpg" alt="Threshold" class="figure mx-auto d-block"></figure><p>Applying a set number to an image as a threshold is simple, but it’s
not ideal having to guess an appropriate threshold until we get a
sensible one. Looking at the histogram helps, but still requires some
manual interpretation and human subjectivity:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">hist</span><span class="er">(</span><span class="fu">img.flatten()</span><span class="ex">,</span> bins=100<span class="kw">)</span></span></code></pre>
</div>
<figure><img src="fig/3_2_histogram.jpg" alt="Histogram" class="figure mx-auto d-block"></figure><p>Fortunately, there are several algorithms for automatically
determining an appropriate threshold based on the image’s histogram.
<strong>Global</strong> thresholds work on the entire image, whereas
<strong>local</strong> thresholds work on a window around each pixel -
this course will deal only with global filters.</p>
<div id="exercise-11-thresholds" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-11-thresholds" class="callout-inner">
<h3 class="callout-title">Exercise 11: Thresholds<a class="anchor" aria-label="anchor" href="#exercise-11-thresholds"></a>
</h3>
<div class="callout-content">
<p>Look at the <a href="https://scikit-image.org/docs/stable/api/skimage.filters.html" class="external-link">skimage
filter docs</a> and find each of the following threshold algorithms:</p>
<ul>
<li>Otsu threshold</li>
<li>Triangle threshold</li>
</ul>
<p>Try running each of these algorithms on your image from exercise 10,
and apply the resulting threshold on it. How do the results differ?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>We can display the two threshold algorithms in a figure:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>plt.imshow(skimage.filters.gaussian(img))</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>plt.title(<span class="st">'Gaussian filter'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co"># Otsu threshold</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>threshold <span class="op">=</span> skimage.filters.threshold_otsu(img)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>plt.imshow(img <span class="op">&gt;</span> threshold)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>plt.title(<span class="st">'Otsu threshold'</span>)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co"># Triangle threshold</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>threshold <span class="op">=</span> skimage.filters.threshold_triangle(img)</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>plt.imshow(img <span class="op">&gt;</span> threshold)</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>plt.title(<span class="st">'Triangle threshold'</span>)</span></code></pre>
</div>
<figure><img src="fig/3_3_otsu_triangle.jpg" alt="Otsu and Triangle thresholds" class="figure mx-auto d-block"></figure><p>Which threshold performs better can depend on the image you have.
Otsu thresholding is less sensitive so foreground objects are more
likely to be incomplete or have holes in them, whereas triangle
thresholding has a greater tendency for close foreground objects to
become stuck together.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="cleaning-up">Cleaning up<a class="anchor" aria-label="anchor" href="#cleaning-up"></a>
<a class="anchor" aria-label="anchor" href="#cleaning-up"></a>
</h2>
<hr class="half-width">
<p>Once we have a binary image, we may still need to clean it up
further. There may still be extraneous pixels and other bits around the
regions of interest, or there may be holes in a shape that you need to
be solid.</p>
<div id="exercise-12-erosion-dilation-opening-and-closing" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-12-erosion-dilation-opening-and-closing" class="callout-inner">
<h3 class="callout-title">Exercise 12: Erosion, dilation, opening and closing<a class="anchor" aria-label="anchor" href="#exercise-12-erosion-dilation-opening-and-closing"></a>
</h3>
<div class="callout-content">
<p>Look at the <a href="https://scikit-image.org/docs/stable/api/skimage.morphology.html" class="external-link">skimage
morphology docs</a>. Select one of your binary images from exercise 11
and apply each of the following algorithms to the image:</p>
<ul>
<li>Binary erosion</li>
<li>Binary dilation</li>
<li>Binary opening</li>
<li>Binary closing</li>
</ul>
<p>Note: each of the algorithms above will require a kernel or
footprint. For this, use a disc-shaped kernel of radius 4:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">kernel</span> = skimage.morphology.disk<span class="er">(</span><span class="ex">4</span><span class="kw">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">12</span>))</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>kernel <span class="op">=</span> skimage.morphology.disk(<span class="dv">4</span>)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co"># Original image</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>plt.imshow(binary_image)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co"># Erosion</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>plt.imshow(skimage.morphology.binary_erosion(binary_image, footprint<span class="op">=</span>kernel))</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co"># Dilation</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>plt.imshow(skimage.morphology.binary_dilation(binary_image, footprint<span class="op">=</span>kernel))</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co"># Opening</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>plt.imshow(skimage.morphology.binary_opening(binary_image, footprint<span class="op">=</span>kernel))</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co"># Closing</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>)</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>plt.imshow(skimage.morphology.binary_closing(binary_image, footprint<span class="op">=</span>kernel))</span></code></pre>
</div>
<figure><img src="fig/3_4_transforms.jpg" alt="Image transformations" class="figure mx-auto d-block"></figure><p>Eroding has the effect of shrinking all foreground features. Dilating
has the opposite effect, potentially resulting in foreground features
becoming stuck together.</p>
<p>Opening an image is an erosion followed by a dilation. If your image
is grainy with many small artifacts, these will be removed.</p>
<p>Closing is the opposite - dilation followed by erosion. This will
have the effect of filling in any holes in your foreground features.</p>
</div>
</div>
</div>
</div>
<p>If there are still holes in your binary image, there is also a
function in ndimage that will fix this:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">binary_img</span> = scipy.ndimage.binary_fill_holes<span class="er">(</span><span class="ex">binary_img</span><span class="kw">)</span></span></code></pre>
</div>
<figure><img src="fig/3_5_fill_holes.jpg" alt="Binary fill holes" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="labelling">Labelling<a class="anchor" aria-label="anchor" href="#labelling"></a>
<a class="anchor" aria-label="anchor" href="#labelling"></a>
</h2>
<hr class="half-width">
<p>In some situations, it may be necessary to distinguish between
individual features, e.g. if counting cell nuclei. For this, it is
necessary to isolate or <strong>label</strong> individual separated
objects in the foreground:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">labels</span> = skimage.morphology.label<span class="er">(</span><span class="ex">binary_img</span><span class="kw">)</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">plt.imshow</span><span class="er">(</span><span class="ex">labels</span><span class="kw">)</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="fu">plt.colorbar()</span></span></code></pre>
</div>
<p>This will result in an image similar to the binary image supplied,
but instead of just 1s, each feature will have a unique number assigned
to all of its pixels. Displaying this with a colour scale will
effectively colour-code each one:</p>
<figure><img src="fig/3_6_labels.jpg" alt="Image labelling" class="figure mx-auto d-block"></figure><p>However, we can see that the process is not perfect, as nuclei that
are stuck together have been marked as the same feature. In the
exercises below, we will explore how to solve this.</p>
</section><section><h2 class="section-heading" id="watershed-transform">Watershed transform<a class="anchor" aria-label="anchor" href="#watershed-transform"></a>
<a class="anchor" aria-label="anchor" href="#watershed-transform"></a>
</h2>
<hr class="half-width">
<p>Several transforming or segmentation operations exist for solving
situations like the one above with touching objects.</p>
<p>This transformation requires a few preparation steps. First, we need
a <strong>distance transform</strong> of the binary image, where each
foreground pixel’s value is its Euclidean distance to the background.
skimage doesn’t have a function for this, but scipy does:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">dt</span> = scipy.ndimage.distance_transform_edt<span class="er">(</span><span class="ex">binary_img</span><span class="kw">)</span></span></code></pre>
</div>
<figure><img src="fig/3_7_distance_transform.jpg" alt="Distance transform" class="figure mx-auto d-block"></figure><p>Next, we need the coordinates of all <strong>local maxima</strong>,
i.e. locations that are furthest away from the background. This requires
a kernel/footprint, which in this example is a square kernel of 7x7:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">coords</span> = skimage.feature.peak_local_max<span class="er">(</span><span class="ex">dt,</span> labels=binary_img<span class="kw">)</span></span></code></pre>
</div>
<p>This gives us a list of coordinates, so we need to convert this back
into an labelled image of maxima. This will be mostly blank with an
individually labelled dot representing each one:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">mask</span> = numpy.zeros<span class="er">(</span><span class="ex">dt.shape,</span> dtype=bool<span class="kw">)</span>  <span class="co"># blank image the same size as the original</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="va">mask</span><span class="op">[</span>tuple(coords.T)<span class="op">]</span> <span class="ex">=</span> True              <span class="co"># create a foreground pixel at each set of coordinates</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="ex">markers</span> = skimage.morphology.label<span class="er">(</span><span class="ex">mask</span><span class="kw">)</span>  <span class="co"># uniquely label them</span></span></code></pre>
</div>
<figure><img src="fig/3_8_maxima.png" alt="Local maxima" class="figure mx-auto d-block"></figure><p>Note the <code>.T</code> to transpose the maxima coordinates.</p>
<p>At this point depending on your image, you may get clusters of peaks
close together rather than one clean, distinct peak per feature. This is
especially likely if your features are not circular. Applied to the
final watershed step below, this will result in features being split
when they shouldn’t be. This can be resolved in several ways:</p>
<ol style="list-style-type: decimal">
<li>
<p>Smoothing the distance transform:</p>
<p>dt = scipy.ndimage.distance_transform_edt(binary_img) dt =
skimage.filters.gaussian(dt, sigma=4)</p>
</li>
<li>
<p>Applying a larger footprint to peak_local_max:</p>
<p>coords = skimage.feature.peak_local_max(dt,
footprint=numpy.ones((7,7)), labels=binary_img)</p>
</li>
<li>
<p>Providing a <code>min_distance</code> argument to peak_local_max,
which will prevent the function from identifying peaks too close
together:</p>
<p>coords = skimage.feature.peak_local_max(dt, min_distance=10,
labels=binary_img)</p>
</li>
</ol>
<p>Finally, the transform can be done. One final note is that because of
the <a href="https://bioimagebook.github.io/chapters/2-processing/6-transforms/transforms.html#the-watershed-transform" class="external-link">way
watershed transforms work</a>, we need to convert the distance map from
peaks to troughs by inverting it with <code>-</code>:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">labels</span> = skimage.segmentation.watershed<span class="er">(</span><span class="ex">-dt,</span> markers, mask=binary_img<span class="kw">)</span></span></code></pre>
</div>
<figure><img src="fig/3_9_watershed.jpg" alt="Watershed segmentation" class="figure mx-auto d-block"></figure><div class="section level3">
<h3 id="masked-watershed">Masked watershed<a class="anchor" aria-label="anchor" href="#masked-watershed"></a>
</h3>
<p>The result of the watershed transform above does not indicate the
shape of the nuclei. Rather, the algorithm effectively decides which
nucleus each pixel of the image most closely corresponds to. We can
generate a more meaningful image by combining the watershed and the
binary image together to create a <strong>masked watershed</strong>:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">masked_watershed</span> = watershed_transform <span class="pp">*</span> binary_img</span></code></pre>
</div>
<figure><img src="fig/3_10_masked_watershed.png" alt="Masked watershed" class="figure mx-auto d-block"></figure><p>It’s also possible to do the last two steps in one by providing
<code>mask=some_binary_image</code> to
skimage.segmentation.watershed.</p>
<div id="exercise-13-image-segmentation" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-13-image-segmentation" class="callout-inner">
<h3 class="callout-title">Exercise 13: Image segmentation<a class="anchor" aria-label="anchor" href="#exercise-13-image-segmentation"></a>
</h3>
<div class="callout-content">
<ul>
<li>Load up your image from exercise 10 and run
<code>skimage.morphology.label</code> on the foreground features</li>
<li>How many features did skimage find? (hint: try flattening your
labelled image)</li>
<li>Perform a watershed transform on your binary image as above. Try
displaying the result of each stage of the transform.</li>
<li>How many features are identified now after watershed
transformation?</li>
<li>Does the watershed transformation work perfectly?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Labelling applies a unique number to each feature. This means that if
we apply thresholding and labelling to the image, we can flatten the
result and cast it to a set to find all the unique label numbers
present, and find the highest numbered label to get the number of
features:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>threshold <span class="op">=</span> skimage.filters.threshold_triangle(img)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>binary_img <span class="op">=</span> img <span class="op">&gt;</span> threshold</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>plt.imshow(binary_img)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>labels <span class="op">=</span> skimage.morphology.label(img)</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>plt.imshow(labels)</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>flat <span class="op">=</span> labels.flatten()</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">set</span>(flat))</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">max</span>(flat))</span></code></pre>
</div>
<p>However, we see from the intermediate images that multiple touching
nuclei are treated as a single feature.</p>
<p>Here is an example of using distance and watershed transforms to
segment touching objects:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>plt.imshow(img)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>dt <span class="op">=</span> scipy.ndimage.distance_transform_edt(binary_img)</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>plt.imshow(dt)</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>coords <span class="op">=</span> skimage.feature.peak_local_max(dt, min_distance<span class="op">=</span><span class="dv">10</span>, labels<span class="op">=</span>binary_img)</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>mask <span class="op">=</span> numpy.zeros(dt.shape, dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>mask[<span class="bu">tuple</span>(coords.T)] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>plt.imshow(mask)</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>markers <span class="op">=</span> skimage.morphology.label(mask)</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>labels <span class="op">=</span> skimage.segmentation.watershed(<span class="op">-</span>dt, markers, mask<span class="op">=</span>binary_img)</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>plt.imshow(labels)</span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">set</span>(labels.flatten()))</span></code></pre>
</div>
<p>This will segment more correctly, however the accuracy of the process
still depends on the inputs supplied. Irregular objects with holes in
them will be harder to segment than even, solid, rounded shapes.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Thresholding, labelling and feature isolation are all forms of
segmentation</li>
<li>Different thresholding algorithms can perform differently in
different situations</li>
<li>Quantitative image analysis often requires us to individually label
features</li>
<li>Processing such as watershed transforms can solve cases where
features of interest are very close or stuck together</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-04-measurements"><p>Content from <a href="04-measurements.html">Measurements</a></p>
<hr>
<p>Last updated on 2024-04-29 |

        <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/edit/main/episodes/04-measurements.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I use image segmentation to make useful measurements in my
image?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Find the mean pixel intensity in each nucleus</li>
<li>Find each nucleus’ area</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Having isolated individual nuclei in the example image in the
previous chapter, we can make some observations about the image
features. The exercises here will require:</p>
<ul>
<li>Your masked watershed transformation from the previous chapter</li>
<li>Your original image from exercise 10</li>
</ul>
<div class="section level3">
<h3 id="processing-one-nucleus-at-a-time">Processing one nucleus at a time<a class="anchor" aria-label="anchor" href="#processing-one-nucleus-at-a-time"></a>
</h3>
<p>Remember that each nucleus is labelled with a unique number, so we
can select a single nucleus with masking. We can construct a binary mask
from a labelled image using numpy’s <a href="https://numpy.org/doc/stable/reference/generated/numpy.where.html" class="external-link">where
function</a>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">nucleus_1</span> = numpy.where<span class="er">(</span><span class="ex">masked_watershed</span> == 1, 1, 0<span class="kw">)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">nucleus_2</span> = numpy.where<span class="er">(</span><span class="ex">masked_watershed</span> == 2, 1, 0<span class="kw">)</span></span></code></pre>
</div>
<p>Here, each pixel will be set to either 1 or 0 depending on whether
its value matches the label we’re looking for.</p>
<div id="exercise-14-quantifying-intensities" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-14-quantifying-intensities" class="callout-inner">
<h3 class="callout-title">Exercise 14: Quantifying intensities<a class="anchor" aria-label="anchor" href="#exercise-14-quantifying-intensities"></a>
</h3>
<div class="callout-content">
<p>For each labelled nucleus:</p>
<ul>
<li>Construct a binary mask matching the label number</li>
<li>Use this to isolate the individual nucleus out of the
<strong>original image</strong>
<ul>
<li>Hint: try looking at the <a href="https://numpy.org/doc/stable/reference/generated/numpy.where.html" class="external-link"><code>numpy.where</code></a>
docs to see the different ways it can be used.</li>
</ul>
</li>
<li>Find the mean pixel value for the nucleus</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>First, we need to know how many features we’re looping over. We can
get that from the numbers that the labelling process provides - if your
labelled image contains the labels 1, 2 and 3, then you have 3
features.</p>
<p>Next, we need to generate a mask for that feature using
<code>numpy.where</code>, that will allow us to mask out the original
image - in this case, either a corresponding pixel value from the
original image or <code>None</code>. We can then take the result of
that, select all pixels that are not <code>None</code> and use
<code>numpy.mean</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">16</span>))</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">max</span>(masked_watershed.flatten()) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    _mask <span class="op">=</span> numpy.where(masked_wt <span class="op">==</span> i, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    _nucleus <span class="op">=</span> numpy.where(_mask <span class="op">==</span> <span class="dv">1</span>, img, <span class="dv">0</span>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, i)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    plt.imshow(_nucleus, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    pixels <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> _nucleus.flatten() <span class="cf">if</span> p <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>]</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Feature </span><span class="sc">%i</span><span class="st">:'</span> <span class="op">%</span> i, numpy.mean(pixels))</span></code></pre>
</div>
<figure><img src="fig/4_1_mean_intensities.png" alt="Mean intensities" class="figure mx-auto d-block"></figure><p>A few notes:</p>
<ul>
<li>The arguments to <code>range</code> are offset by +1, since we want
to count up from 1, not 0, i.e. select only foreground objects - since 0
will be the background.</li>
<li>In the first <code>numpy.where</code> above, we supply two single
numbers, 1 and 0. The function can however take an n-dimensional array
instead, which is what we do in the second one. In this case, it will
select the value of the corresponding pixel.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Binary multiplication and <code>numpy.where</code> are powerful ways
of combining images and masks</li>
<li>The numbers assigned during labelling can be used to select and
process one feature at a time</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div></section><section id="aio-05-napari"><p>Content from <a href="05-napari.html">Introduction to Napari</a></p>
<hr>
<p>Last updated on 2024-04-30 |

        <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/edit/main/episodes/05-napari.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I view images and metadata in Napari?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Open and explore some images and compare the process of doing the
same process in Python</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="starting-napari">Starting Napari<a class="anchor" aria-label="anchor" href="#starting-napari"></a>
<a class="anchor" aria-label="anchor" href="#starting-napari"></a>
</h2>
<hr class="half-width">
<p>With Napari installed, run:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">napari</span></span></code></pre>
</div>
<p>This will start up Napari in a new window. This may take about a
minute, especially if being done for the first time.</p>
</section><section><h2 class="section-heading" id="looking-around">Looking around<a class="anchor" aria-label="anchor" href="#looking-around"></a>
<a class="anchor" aria-label="anchor" href="#looking-around"></a>
</h2>
<hr class="half-width">
<p>In the ‘File’ menu, go to ‘Open Sample -&gt; ’napari builtins -&gt;
Cells (3D+2Ch). Looking at the sidebar, Napari has opened two
<strong>layers</strong> - ’membrane’ and ‘nuclei’. At the top of the
sidebar there are options for displaying layers in different colours and
opacity, and the eye symbol on the layer can be checked or unchecked to
show/hide it:</p>
<figure><img src="fig/5_1_layers.jpg" alt="Napari layers" class="figure mx-auto d-block"></figure><p>Napari uses layers to represent each stage of processing an image -
we run tools to create new processed layers based off of a previous one.
In this example, the image consists of two channels, each of which has
been loaded as a layer.</p>
<p>In the case of z-stack or time series images such as this one, there
is also a slider at the bottom for scrolling through the layers.</p>
<div id="exercise-15-opening-an-image" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-15-opening-an-image" class="callout-inner">
<h3 class="callout-title">Exercise 15: Opening an image<a class="anchor" aria-label="anchor" href="#exercise-15-opening-an-image"></a>
</h3>
<div class="callout-content">
<p>With ‘Cells (3D + 2Ch)’ open, go to ‘Tools -&gt; Filtering / Noise
Removal’ and look at the options available. What are these options? What
happens if you select one and try running it on a layer?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>The options here consist of smoothing filters, several of which will
be familiar from previous chapters. In some cases there are multiple
versions of a filter (e.g. there are three Gaussian filters), each of
which uses a different Python library.</p>
<p>Selecting one of these gives a sidebar letting us choose how to run
it, including which layer to use, plus any extra parameters it may take,
such as sigma values for Gaussian filters:</p>
<figure><img src="fig/5_2_gaussian_filter_controls.jpg" alt="Gaussian filter controls" class="figure mx-auto d-block"></figure><figure><img src="fig/5_3_gaussian_filter.jpg" alt="Gaussian filter" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="loading-real-world-images">Loading real-world images<a class="anchor" aria-label="anchor" href="#loading-real-world-images"></a>
<a class="anchor" aria-label="anchor" href="#loading-real-world-images"></a>
</h2>
<hr class="half-width">
<p>The example images work nicely with Napari, but sometimes it may be
necessary to coax Napari into loading an image correctly. In ‘File’,
select ‘Open File(s)…’ and load up FluorescentCells_3channel.tif. Doing
this, we find the results aren’t quite what we expect - the three
channels have been loaded as if they’re a z-stack.</p>
<p>Fortunately, Napari includes a Python console that gives us very
fine-grained control of the user interface, and will let us load this
image correctly. In the bottom left, use the ’&gt;_’ button to open a
terminal. This activates a Python session where Napari is represented as
an object called <code>viewer</code>:</p>
<figure><img src="fig/5_4_python_console.png" alt="Napari Python console" class="figure mx-auto d-block"></figure><ul>
<li>All the loaded layers are in a list called
<code>viewer.layers</code>
</li>
<li>Within a layer, the image data is an attribute called
<code>data</code>
</li>
</ul>
<p>In this console, we can create new layers with
<code>viewer.add_image</code>. First, let’s look at the image’s
shape:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">from</span> skimage.io <span class="im">import</span> imread</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>img <span class="op">=</span> imread(<span class="st">'path/to/FluorescentCells_3channel.tif'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>img.shape</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>(<span class="dv">512</span>, <span class="dv">512</span>, <span class="dv">3</span>)</span></code></pre>
</div>
<p>From this, we can see that the colour channels are the third axis.
Using this, We can now load each channel as a new layer:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>viewer.add_image(img[:, :, <span class="dv">0</span>], name<span class="op">=</span><span class="st">'FluorescentCells_ch0'</span>, colormap<span class="op">=</span><span class="st">'cyan'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>viewer.add_image(img[:, :, <span class="dv">1</span>], name<span class="op">=</span><span class="st">'FluorescentCells_ch1'</span>, colormap<span class="op">=</span><span class="st">'yellow'</span>, blending<span class="op">=</span><span class="st">'additive'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>viewer.add_image(img[:, :, <span class="dv">2</span>], name<span class="op">=</span><span class="st">'FluorescentCells_ch2'</span>, colormap<span class="op">=</span><span class="st">'magenta'</span>, blending<span class="op">=</span><span class="st">'additive'</span>)</span></code></pre>
</div>
<p>The <code>blending='additive'</code> option prevents layers on top
from obscuring layers below it so that we can view multiple layers at
once. We also need to colour the layers so we can distinguish them from
each other.</p>
<p><code>viewer.add_image</code> is also able to load all these layers
in one if we tell it which axis represents the colour channels:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>viewer.add_image(img, name<span class="op">=</span><span class="st">'FluorescentCells'</span>, channel_axis<span class="op">=</span><span class="dv">2</span>)</span></code></pre>
</div>
<div id="exercise-16-real-world-images" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-16-real-world-images" class="callout-inner">
<h3 class="callout-title">Exercise 16: Real world images<a class="anchor" aria-label="anchor" href="#exercise-16-real-world-images"></a>
</h3>
<div class="callout-content">
<ul>
<li>Load the image ‘confocal-series_zstack.tif’, look at its shape and
identify which axis looks like the channels.</li>
<li>Use <code>viewer.add_image</code> with the <code>channel_axis</code>
argument to load the image. How has the fourth axis been
represented?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>From loading the image in the Python console:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>img <span class="op">=</span> skimage.io.imread(<span class="st">'path/to/confocal-series_zstack.tif'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>img.shape</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>(<span class="dv">25</span>, <span class="dv">2</span>, <span class="dv">400</span>, <span class="dv">400</span>)</span></code></pre>
</div>
<p>The second number, i.e. <code>img.shape[1]</code> looks like the
channel axis. We can then provide this when loading the image:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>viewer.add_image(img, name<span class="op">=</span><span class="st">'FluorescentCells'</span>, channel_axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre>
</div>
<p>Napari will load the image as two coloured layers, with the Z axis
represented via the slider at the bottom.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="wrapup-challenge-image-segmentation-in-napari">Wrapup challenge: image segmentation in Napari<a class="anchor" aria-label="anchor" href="#wrapup-challenge-image-segmentation-in-napari"></a>
<a class="anchor" aria-label="anchor" href="#wrapup-challenge-image-segmentation-in-napari"></a>
</h2>
<hr class="half-width">
<p>These two exercises will put together everything that has been
covered in previous chapters, and apply the data processing performed in
Python/Jupyter to Napari. Finally, we will see how the processing that
we have built up in Napari can be exported back to Python code that we
can then run on many images as a script to help automate our image
processing.</p>
<div id="exercise-17-image-segmentation-in-napari" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-17-image-segmentation-in-napari" class="callout-inner">
<h3 class="callout-title">Exercise 17: Image segmentation in Napari<a class="anchor" aria-label="anchor" href="#exercise-17-image-segmentation-in-napari"></a>
</h3>
<div class="callout-content">
<p>Look at the ‘nuclei’ layer of ‘Cells (3D + 2Ch)’. Explore the options
available in ‘Tools’ and try segmenting and labelling the nuclei. A few
things to think of:</p>
<ul>
<li>Although we’re working in a different environment from Jupyter, the
stages of processing will remain the same</li>
<li>Remember that Napari works with layers, so the results of each tool
used will depend on which layer it’s used on</li>
<li>Napari names some functions differently. When it’s referring to
thresholding, for example, it uses the term
‘<strong>binarising</strong>’</li>
<li>Napari has some tools that combine esveral steps of processing into
one. Try using the tools to perform each individual step</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">

</div>
</div>
</div>
</div>
<div id="exercise-18-exporting-code" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-18-exporting-code" class="callout-inner">
<h3 class="callout-title">Exercise 18: Exporting code<a class="anchor" aria-label="anchor" href="#exercise-18-exporting-code"></a>
</h3>
<div class="callout-content">
<p>Open the Napari Assistant and find the ‘Export Python code’ tool. Use
this to generate a Python script that will perform the processing that
you performed in the previous exercise. Is the script usable immediately
without modification?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>There are several options to export in different ways, including to a
Jupyter notebook. The simplest way is probably to copy to clipboard -
this can be pasted into a text editor or IDE.</p>
<p>Looking at it, though, we can see that it’s not immediately usable.
Exported scripts do not make any reference to what image file was
loaded, and there is no code at the end for writing the resuults to a
file. Therefore, the script will require some tweaking to parameterise
it and get it to produce tangible output.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Napari works with layers, each of which represents an image
channel</li>
<li>Napari doesn’t always know how to load a multi-channel image from
the GUI</li>
<li>We can use the Python console to perform custom operations that
can’t be done in the GUI</li>
<li>Most operations we performed earlier in Python can also be done in
Napari, either graphically or in the terminal</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/" class="external-link">Source</a></p>
				<p><a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.5" class="external-link">sandpaper (0.16.5)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.3" class="external-link">varnish (1.0.3)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://IGC-Advanced-Imaging-Resource.github.io/image-analysis-python-napari/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "image, python, napari, scikit-image",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://IGC-Advanced-Imaging-Resource.github.io/image-analysis-python-napari/aio.html",
  "identifier": "https://IGC-Advanced-Imaging-Resource.github.io/image-analysis-python-napari/aio.html",
  "dateCreated": "2023-09-19",
  "dateModified": "2024-07-30",
  "datePublished": "2024-07-30"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

