<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Microscopy Image Analysis with Python and Napari: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Microscopy Image Analysis with Python and Napari
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Microscopy Image Analysis with Python and Napari
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Microscopy Image Analysis with Python and Napari
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-opening-and-checking-an-image.html">1. Opening and Checking an Image</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-applying-filters.html">2. Applying Filters</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-thresholding-and-segmentation.html">3. Thresholding and Segmentation</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-measurements.html">4. Measurements</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-napari.html">5. Introduction to Napari</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-opening-and-checking-an-image"><p>Content from <a href="01-opening-and-checking-an-image.html">Opening and Checking an Image</a></p>
<hr>
<p>Last updated on 2025-03-18 |

        <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/edit/main/episodes/01-opening-and-checking-an-image.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I open an image file in Python for processing?</li>
<li>How can I explore an image once it’s open?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Open an image with skimage</li>
<li>Discuss how to open proprietary image formats</li>
<li>Display an opened image to the screen</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="opening-an-image">Opening an image<a class="anchor" aria-label="anchor" href="#opening-an-image"></a>
</h2>
<hr class="half-width">
<p>At its core, an image is a multidimensional array of numbers, and as
such can be opened by programs and libraries designed for working with
this kind of data. For Python, one such library is scikit-image. This
library provides a function called <code>imread</code> that we can use
to load an image into memory. In a new notebook cell:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">from</span> skimage.io <span class="im">import</span> imread</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>image <span class="op">=</span> imread(<span class="st">'data/FluorescentCells_3channel.tif'</span>)</span></code></pre>
</div>
<p>If you saved your images to a different location, you will need to
change the file path provided to imread accordingly. Paths will be
relative to the location of your .ipynb notebook file.</p>
<p>To view things in Python, usually we use <code>print()</code>.
However if we try to print this image to the Jupyter console, instead of
the image we get something that may be unexpected:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&gt; print(image)
array([[[ 16,  50,   0],
        [ 15,  44,   0],
        [ 18,  40,   1],
        ...,
        [  1,  15,   2],
        [  1,  15,   2],
        [  1,  15,   2]]], dtype=uint8)</code></pre>
</div>
<p>Python has loaded and stored the image as a Numpy <code>array</code>
object of numbers, and <code>print()</code> displays the string
representation or textual form of the data passed to it, which is why we
get a matrix of numbers printed to the screen.</p>
<p>If we want to see what the image looks like, we need tell Python to
display it as an image. We can do this with the <code>imshow</code>
function from matplotlib, which you may already be familiar with as a
library for drawing plots and graphs, but it can also display
images.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>plt.set_cmap(<span class="st">'gray'</span>)  <span class="co"># by default, single-channel images will now be displayed in greyscale</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>plt.imshow(image)</span></code></pre>
</div>
<p>You should now see the image displayed below the current cell:</p>
<figure><img src="fig/1_1_imshow.jpg" alt="Displaying an image with imshow" class="figure mx-auto d-block"></figure><p>Since images are multi-dimensional arrays of numbers, we can apply
statistical functions to them and extract some basic metrics. Numpy
arrays have methods for several of these already, including the image’s
shape, data type and minimum/maximum values:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="bu">print</span>(image.shape, image.dtype, image.<span class="bu">min</span>(), image.<span class="bu">max</span>())</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co"># returns: (512, 512, 3) uint8 0 255</span></span></code></pre>
</div>
<p>This shows that the image has a data type of uint8, it contains
values between 0 and 255 and that it is in three dimensions. We can
reasonably infer that the two <code>512</code> numbers are the X and Y
axes. The third axis in most cases will represent a number of
channels.</p>
<p>We can select a single channel by <strong>indexing</strong> the
array:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>plt.imshow(image[:, :, <span class="dv">2</span>])</span></code></pre>
</div>
<p>Here, we select the entire X and Y axes using <code>:</code> with no
numbers around them, and the last channel (remember that Python counts
from 0).</p>
</section><section><h2 class="section-heading" id="channels-series-and-stacks">Channels, series and stacks<a class="anchor" aria-label="anchor" href="#channels-series-and-stacks"></a>
</h2>
<hr class="half-width">
<p>Images can consist of more than two axes. The first two axes are
usually X and Y, but if there is a third axis, then this could be one of
several things:</p>
<ul>
<li>
<strong>Channel</strong> - the image shows different features in the
same 2D space. One common example is cell images with different staining
for nuclei and membranes, expressed as different colours.</li>
<li>
<strong>Time series</strong> - the image is a collection of 2D
frames taken at different points in time.</li>
<li>
<strong>Z-stack</strong> - essentially a series of 2D images piled
up on top of each other in 3D space.</li>
</ul>
<p>It’s usually easy enough to tell that you’re looking at a colour
channel from looking at the image directly, but it may be more difficult
to to distinguish a Z or a timepoint axis from the data alone. If you
don’t know exactly how the images were generated, it’s a good idea to
consult documentation or metadata.</p>
<div id="exercise-1-loading-an-image" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-1-loading-an-image" class="callout-inner">
<h3 class="callout-title">Exercise 1: Loading an image</h3>
<div class="callout-content">
<p>Load the test image ‘FluorescentCells_3channel.tif’:</p>
<ul>
<li>Try the same as the example above, but display one of the other
channels</li>
<li>Save your single channel to a variable. What happens if you run
<code>imshow</code> on <code>channel.T</code>?</li>
<li>How can we select part of the image, i.e. crop it? Remember that to
do this, we need to select a subset of the X and/or Y axes.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Other channels can be loaded with <code>image[:, :, x]</code>, where
<code>image</code> is the variable the image is saved to and
<code>x</code> is the index of a channel to retrieve.</p>
<p>Next we can use <code>.T</code> to return a
<strong>transposed</strong> version of the image. Running
<code>imshow()</code> on this results in an image that is flipped
90°:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>channel <span class="op">=</span> image[:, :, <span class="dv">1</span>]</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>plt.imshow(channel.T)</span></code></pre>
</div>
<figure><img src="fig/1_2_transpose.jpg" alt="Transposed image" class="figure mx-auto d-block"></figure><p>Remember that Numpy arrays can be sliced and indexed the same way as
lists, strings and tuples. Up to this point we’ve been using
<code>:</code> to select an entire axis, but we can give it start and
end bounds to select part of the X and Y axes, like:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>image[:<span class="dv">256</span>, <span class="dv">128</span>:<span class="dv">384</span>, <span class="dv">1</span>]</span></code></pre>
</div>
<figure><img src="fig/1_3_2d_slice.jpg" alt="2-dimensional slice" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>Numpy arrays have many more methods available for checking them. Here
are just a few to start with:</p>
<div class="section level3">
<h3 id="pixel-value-statistics">Pixel value statistics<a class="anchor" aria-label="anchor" href="#pixel-value-statistics"></a>
</h3>
<ul>
<li><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.mean.html" class="external-link"><code>image.mean()</code></a></li>
<li><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.min.html" class="external-link"><code>image.min()</code></a></li>
<li><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.max.html" class="external-link"><code>image.max()</code></a></li>
<li><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.std.html" class="external-link"><code>image.std()</code></a></li>
</ul>
</div>
<div class="section level3">
<h3 id="image-size">Image size<a class="anchor" aria-label="anchor" href="#image-size"></a>
</h3>
<p><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.shape.html" class="external-link"><code>image.shape</code></a></p>
</div>
<div class="section level3">
<h3 id="object-size">Object size<a class="anchor" aria-label="anchor" href="#object-size"></a>
</h3>
<p><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.nbytes.html" class="external-link"><code>image.nbytes</code></a></p>
<p>Note that some of these are functions and need to be called with
brackets(<code>()</code>), whereas others are simply attributes that do
not.</p>
<div id="exercise-2-memory-check" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-2-memory-check" class="callout-inner">
<h3 class="callout-title">Exercise 2: Memory check</h3>
<div class="callout-content">
<p>How much memory did it take to load
FluorescentCells_3channel.tif?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Running <code>image.nbytes</code> shows that it takes up 786432
bytes, or ~786 kilobytes, or ~0.7 megabytes.</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="displaying-one-channel-at-a-time">Displaying one channel at a time<a class="anchor" aria-label="anchor" href="#displaying-one-channel-at-a-time"></a>
</h2>
<hr class="half-width">
<p>We’ve seen from exercise 1 that we can view single channels by
indexing the array. We can also show all channels together using a
matplotlib figure:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))  <span class="co"># figure size, in inches</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>nchannels <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(nchannels):</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    <span class="co"># Use subplot() to create a multi-image figure with 1 row and 3 columns. We need to increment i by 1</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    <span class="co"># because range() counts from 0 but subplot() assumes you're counting from 1.</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    plt.subplot(<span class="dv">1</span>, nchannels, i<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>    plt.imshow(image[:, :, i])</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>    plt.title(<span class="st">'Channel </span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> i)  <span class="co"># add a plot title</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    plt.axis(<span class="va">False</span>)              <span class="co"># we just want to show the image, so turn off the axis labels</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
<figure><img src="fig/1_4_all_channels.jpg" alt="All image channels" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="histograms">Histograms<a class="anchor" aria-label="anchor" href="#histograms"></a>
</h2>
<hr class="half-width">
<p>Another useful metric in image analysis is an image’s histogram. This
can be plotted by flattening the image and passing it to matplotlib:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>plt.hist(image[:, :, <span class="dv">0</span>].flatten(), bins<span class="op">=</span><span class="dv">256</span>)</span></code></pre>
</div>
<p>First, we need to select a single channel - since different channels
may represent different cell organelles or points in time, we need to
ensure that we are comparing like with like. We also need
<code>flatten()</code> because we don’t care about the arrangement of
the pixels, we just want to sort their values values into bins. Finally,
we can use <code>bins</code> to control how many bins the data is split
into.</p>
<div id="exercise-3-histograms" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-3-histograms" class="callout-inner">
<h3 class="callout-title">Exercise 3: Histograms</h3>
<div class="callout-content">
<p>Combine the usage of <code>matplotlib.pyplot.hist()</code> and
<code>matplotlib.pyplot.figure()</code> introduced above above and plot
a histogram of each of the three channels in
FluorescentCells_3channel.tif.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Starting with displaying a single histogram for one channel:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>channel_idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>channel <span class="op">=</span> image[:, :, channel_idx]</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>plt.hist(channel.flatten(), bins<span class="op">=</span><span class="dv">255</span>)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>plt.title(<span class="st">'Channel </span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> channel_idx)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
<p>We could call this three times, each with a different value for
<code>channel_idx</code>, or we can use a <strong>for loop</strong>:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))  <span class="co"># figure size, in inches</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>nchannels <span class="op">=</span> image.shape[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(nchannels):</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    channel <span class="op">=</span> image[:, :, i]</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    plt.subplot(<span class="dv">1</span>, nchannels, i<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    plt.hist(channel.flatten(), bins<span class="op">=</span><span class="dv">255</span>)</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    plt.title(<span class="st">'Channel </span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> i)  <span class="co"># add a plot title</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
<figure><img src="fig/1_5_histograms.jpg" alt="All image channels" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="proprietary-formats">Proprietary formats<a class="anchor" aria-label="anchor" href="#proprietary-formats"></a>
</h2>
<hr class="half-width">
<p>Images can come in many formats, but for many of the common ones such
as TIFF, PNG and BMP, skimage is smart enough to know how to read each
one.</p>
<p>Some image formats are associated with specific instruments or
equipment and require specialised packages to open. Depending on your
system, these may already be available via <code>import</code> the same
as any other Python package. If not, then these should be installed into
whatever Python instance you are using.</p>
<p>If using JupyterHub or JupyterLab, go to ‘New’ -&gt; ‘Terminal’. This
will open a shell session in a new browser tab, where you can run
<code>pip install</code> commands.</p>
<div class="section level3">
<h3 id="carl-zeiss--czi">Carl Zeiss .czi<a class="anchor" aria-label="anchor" href="#carl-zeiss--czi"></a>
</h3>
<p>Images in .czi format can be opened with the <code>czifile</code>
library. In the Terminal you opened above:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">$</span> pip install czifile</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="nikon--nd2">Nikon .nd2<a class="anchor" aria-label="anchor" href="#nikon--nd2"></a>
</h3>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">$</span> pip install nd2</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="imaris--ims">Imaris .ims<a class="anchor" aria-label="anchor" href="#imaris--ims"></a>
</h3>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">$</span> pip install imaris-ims-file-reader</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="leica--lif">Leica .lif<a class="anchor" aria-label="anchor" href="#leica--lif"></a>
</h3>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> pip install readlif</span></code></pre>
</div>
<div id="exercise-4-proprietary-formats" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-4-proprietary-formats" class="callout-inner">
<h3 class="callout-title">Exercise 4: Proprietary formats</h3>
<div class="callout-content">
<p>Load the <a href="https://www.talleylambert.com/nd2/#installation" class="external-link">nd2</a> package
and use it to read the test file ‘Ersi_organoid_WT2.nd2’. Install it if
you need to.</p>
<p>What axes are present in the image? Which look most likely to be the
X and Y axes? Use <code>imshow</code> to display a single frame from the
image.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>If not already present, the nd2 package can be installed in the
Terminal with <code>pip install nd2</code>. According to its linked
documentation, it has an <code>imread</code> function that works in a
similar way to the one in skimage, and returns a numpy multidimensional
array that we can work with the same way we have before:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="im">import</span> nd2</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>image <span class="op">=</span> nd2.imread(<span class="st">'data/Ersi_organoid_WT2.nd2'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>image.shape</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co"># returns: (27, 3, 512, 512)</span></span></code></pre>
</div>
<p><code>img.shape</code> shows that there are four axes,
<code>(27, 3, 512, 512)</code>. The latter two numbers look like the X
and Y axes, while the second number looks like a number of colour
channels. The first number looks like either a time series or a Z axis.
We can show a single frame with:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>plt.imshow(image[<span class="dv">0</span>, <span class="dv">0</span>, :, :])</span></code></pre>
</div>
<figure><img src="fig/1_6_nd2_image_frame.jpg" alt="ND2 image" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>As discussed above in exercise 4, it may be difficult to distinguish
a time series from a Z axis. You may also notice that here the X/Y axes
are the latter two numbers, but in other examples above, the X/Y axes
were the first two. This demonstrates the diversity and general lack of
consistency in image formatting, and how it’s usually a good idea to
find out as much as you can about the image from documentation and
metadata before processing it.</p>
</div>
</section><section><h2 class="section-heading" id="altering-the-lookup-table">Altering the lookup table<a class="anchor" aria-label="anchor" href="#altering-the-lookup-table"></a>
</h2>
<hr class="half-width">
<p>Now that we’ve been able to open an image, we can start to explore it
and display it in different ways.</p>
<p>The <code>imshow()</code> function can take extra arguments in
addition to the image to display. One of these is called
<code>cmap</code>, which can apply alternate lookup tables (a.k.a.
colour maps):</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>plt.imshow(image[<span class="dv">0</span>, <span class="dv">0</span>, :, :], cmap<span class="op">=</span><span class="st">'viridis'</span>)</span></code></pre>
</div>
<p>Skimage uses lookup tables from the plotting library matplotlib. A
list of available tables can be obtained with:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> colormaps</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">sorted</span>(colormaps))</span></code></pre>
</div>
<div id="exercise-5-lookup-tables" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-5-lookup-tables" class="callout-inner">
<h3 class="callout-title">Exercise 5: Lookup tables</h3>
<div class="callout-content">
<p>Go back to the FluorescentCells_3channel.tif image. Display each of
its three channels side by side in a matplotlib figure, each in a
different colour using <code>cmap=</code>. Use the values in
<code>matplotlib.colormaps</code> to select a lookup table for each
one.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>There will be many ways to do this (and many colour maps to choose
from!), but here is one possible solution:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># you'll need to run this again if you overwrote your `image` variable</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>image <span class="op">=</span> imread(<span class="st">'data/FluorescentCells_3channel.tif'</span>)</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>plt.imshow(image[:, :, <span class="dv">0</span>], cmap<span class="op">=</span><span class="st">'Blues'</span>)</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>plt.imshow(image[:, :, <span class="dv">1</span>], cmap<span class="op">=</span><span class="st">'Oranges'</span>)</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>plt.imshow(image[:, :, <span class="dv">2</span>], cmap<span class="op">=</span><span class="st">'YlOrBr'</span>)</span></code></pre>
</div>
<figure><img src="fig/1_7_colormaps.jpg" alt="ND2 image" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="exercise-5-lookup-tables" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-5-lookup-tables" class="callout-inner">
<h3 class="callout-title">Exercise 5: Lookup tables<em>
(continued)</em>
</h3>
<div class="callout-content">
<p>Load hela-cells_rgb.tif and try displaying it with different lookup
tables. What results do you get? Why might this be the case?</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Show me the solution </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<p>The resulting image will not look as expected, and in Jupyter the
image will appear unchanged. In this case, since the lookup table is
being ignored, this would imply that the pixel values do not represent
light intensities but rather are explicitly encoded colour values -
i.e. it’s an RGB image.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="other-notes">Other notes<a class="anchor" aria-label="anchor" href="#other-notes"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="rearranging-channels">Rearranging channels<a class="anchor" aria-label="anchor" href="#rearranging-channels"></a>
</h3>
<p>You may find yourself in a situation where the arrangement of
dimensions in your image is incorrect for the processing you wish to
perform on it - maybe a function requires that an image be oriented in a
particular way. This is where it’s useful to be able to rearrange the
dimensions of an image. To do this, we can use Numpy’s
<code>moveaxis</code> function:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="im">import</span> numpy</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>image <span class="op">=</span> imread(<span class="st">'data/FluorescentCells_3channel.tif'</span>)</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="bu">print</span>(image.shape)</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co"># returns: (800, 800, 3)</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>rearranged_image <span class="op">=</span> numpy.moveaxis(image, <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="bu">print</span>(rearranged_image.shape)</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="co"># returns: (3, 800, 800)</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="bu">print</span>(image.shape)</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="co"># returns: (800, 800, 3)</span></span></code></pre>
</div>
<p>We can see that calling <code>moveaxis</code> on an array gives us a
rearranged version of the array given to it - the channel axis that was
at the end is now at the front. However, we can see that the original
value of the image is unchanged. This is because by default,
<code>moveaxis</code> returns a rearranged <strong>copy</strong> of the
image.</p>
<p>The arguments supplied are:</p>
<ul>
<li>The image or array</li>
<li>The current position of the dimension to move</li>
<li>The position to move that dimension to</li>
</ul>
<p>In this case, we are moving the dimension at position -1 (i.e. the
one at the end) to position 0 (the start).</p>
</div>
<div class="section level3">
<h3 id="pixel-size">Pixel size<a class="anchor" aria-label="anchor" href="#pixel-size"></a>
</h3>
<p>Pixels are an approximation of an object - knowing that something is
50 pixels long and 50 pixels wide doesn’t tell us anything about its
actual size. To make any real-world measurements on the image, we need
the image’s <strong>pixel size</strong>.</p>
<p>To get this, it is necessary to read the image’s
<strong>metadata</strong>. For this we need a different library,
imageio. There are a couple of different places we can look:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="im">import</span> imageio</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>meta <span class="op">=</span> imageio.v3.immeta(<span class="st">'data/FluorescentCells_3channel.tif'</span>)</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>props <span class="op">=</span> imageio.v3.improps(<span class="st">'data/FluorescentCells_3channel.tif'</span>)</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'meta:'</span>, meta)</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'props:'</span>, props)</span></code></pre>
</div>
<p><code>immeta()</code> gives us a dict summarising the image, and
<code>improps</code> gives an object with the property ‘spacing’.
However, there is no guarantee that wither of these will contain any
information on pixel size, and the BioimageBook notes that <a href="https://bioimagebook.github.io/chapters/1-concepts/5-pixel_size/python.html#imageio" class="external-link">these
numbers can be misleading</a> and require interpretation and
cross-checking.</p>
<p>Even if <code>immeta()</code> does return a key called ‘unit’, the
value may be returned as escaped Unicode:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="st">'unit'</span><span class="ex">:</span> <span class="st">'\\u00B5m'</span></span></code></pre>
</div>
<p>This can be un-escaped with:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> m<span class="pp">[</span><span class="st">'unit'</span><span class="pp">]</span>.encode<span class="kw">()</span><span class="ex">.decode</span><span class="er">(</span><span class="st">'unicode-escape'</span><span class="kw">)</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="ex">μm</span></span></code></pre>
</div>
<p>Here, this would indicate that the image is to be mesaured in
micrometres. Combining this with other information that may be
available, e.g. <code>improps().spacing</code>, will help you figure out
the pixel size.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Common image formats can usually all be loaded in the same way with
skimage</li>
<li>Specialised proprietary formats may require specialised
libraries</li>
<li>Basic metrics of an image include histogram, shape and max/min pixel
values</li>
<li>These metrics can help tell us how the miage should be analysed</li>
<li>Lookup tables can change how a single-channel image is rendered</li>
<li>An RGB image contains 3 channels for red, green and blue</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-02-applying-filters"><p>Content from <a href="02-applying-filters.html">Applying Filters</a></p>
<hr>
<p>Last updated on 2025-03-18 |

        <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/edit/main/episodes/02-applying-filters.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I make it possible to isolate features in my images?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Apply mean and Gaussian filters to an image</li>
<li>Select one of these filtered images to use for processing in
subsequent chapters</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="filters">Filters<a class="anchor" aria-label="anchor" href="#filters"></a>
</h2>
<hr class="half-width">
<p>Images often need to have noise removed in order for the results of
further processing to be meaningful. There are many smoothing filters
available, each with their own advantages depending on the situation and
the image in question. Here are two to get started:</p>
<ul>
<li><a href="https://scikit-image.org/docs/stable/api/skimage.filters.rank.html#skimage.filters.rank.mean" class="external-link">mean
filter</a></li>
<li><a href="https://scikit-image.org/docs/stable/api/skimage.filters.html#skimage.filters.Gaussian" class="external-link">Gaussian
filter</a></li>
</ul>
<p>A mean filter will, for each pixel:</p>
<ul>
<li>Create a <strong>kernel</strong> of pixels around it, in a
size/shape of the user’s choosing</li>
<li>Take the mean of all pixels within this kernel</li>
<li>Assign this new value to the pixel</li>
</ul>
<p>The kernel in this case can be considered analogous to a
2-dimensional sliding window.</p>
<p>A Gaussian filter is similar to a mean filter, except that pixels
near the centre of the kernel will have a greater effect on the
result.</p>
<p>You can create a kernel with skimage:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">from</span> skimage.morphology <span class="im">import</span> square</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>kernel <span class="op">=</span> square(<span class="dv">3</span>)  <span class="co"># create a 3x3 square kernel</span></span></code></pre>
</div>
<p>There are other shapes of kernel that can be used, and are documented
<a href="https://scikit-image.org/docs/stable/api/skimage.morphology.html" class="external-link">here</a>.</p>
<p>Note that as of skimage 0.25.0, the <code>square</code> function has
been deprecated in favour of a new function, <a href="https://scikit-image.org/docs/stable/api/skimage.morphology.html#skimage.morphology.footprint_rectangle" class="external-link">footprint_rectangle</a>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">from</span> skimage.morphology <span class="im">import</span> footprint_rectangle</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>kernel <span class="op">=</span> square((<span class="dv">3</span>, <span class="dv">3</span>))  <span class="co"># also a 3x3 square kernel</span></span></code></pre>
</div>
<div id="exercise-6-applying-filters" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-6-applying-filters" class="callout-inner">
<h3 class="callout-title">Exercise 6: Applying filters</h3>
<div class="callout-content">
<p>Look at the documentation pages for the mean and Gaussian filters
above. Load a frame from the second channel of the test image <a href="https://scikit-image.org/docs/stable/api/skimage.data.html#skimage.data.cells3d" class="external-link">skimage.data.cells3d</a>:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">from</span> skimage.data <span class="im">import</span> cells3d</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>image <span class="op">=</span> cells3d()[<span class="dv">30</span>, <span class="dv">1</span>, :, :]</span></code></pre>
</div>
<p>Build a figure displaying this image in each of the following
forms:</p>
<ul>
<li>original image</li>
<li>mean filter using a 3x3 square kernel</li>
<li>mean filter using a 9x9 square kernel</li>
<li>Gaussian filter of sigma = 1</li>
<li>Gaussian filter of sigma = 5</li>
</ul>
<p>How do the different methods compare?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">from</span> skimage.data <span class="im">import</span> cells3d</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="im">from</span> skimage.filters <span class="im">import</span> gaussian</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="im">from</span> skimage.filters.rank <span class="im">import</span> mean</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="im">from</span> skimage.morphology.footprints <span class="im">import</span> square</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>image <span class="op">=</span> cells3d()[<span class="dv">30</span>, <span class="dv">1</span>, :, :]</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">12</span>))</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>plt.imshow(image)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>plt.title(<span class="st">'Original'</span>)</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>plt.imshow(mean(image, footprint<span class="op">=</span>square(<span class="dv">3</span>)))</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>plt.title(<span class="st">'3x3 mean filter'</span>)</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>plt.imshow(mean(image, footprint<span class="op">=</span>square(<span class="dv">9</span>)))</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>plt.title(<span class="st">'9x9 mean filter'</span>)</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>plt.imshow(gaussian(image, sigma<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>plt.title(<span class="st">'Gaussian blur, σ=1'</span>)</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>plt.imshow(gaussian(image, sigma<span class="op">=</span><span class="dv">5</span>))</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>plt.title(<span class="st">'Gaussian blur, σ=5'</span>)</span></code></pre>
</div>
<figure><img src="fig/2_1_filters.jpg" alt="Filters" class="figure mx-auto d-block"></figure><p>Larger kernels and sigma values will result in a greater smoothing
effect and a more blurred image - as you can see, it is possible to
over-blur the image.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="removing-the-background">Removing the background<a class="anchor" aria-label="anchor" href="#removing-the-background"></a>
</h2>
<hr class="half-width">
<p>Eventually we’re going to want to isolate the foreground from the
background. In some images, this may be difficult especially if the two
are not entirely distinct from each other, or if the background is not a
uniform shade. In cases like this, a rolling ball algorithm can be
applied. The rolling ball estimates the background intensity of an image
by using the pixel values to translate the image into a height map, and
then rolling a ball of a given radius across it. Additional information
on how it works can be found <a href="https://www.researchgate.net/figure/Schematic-diagram-of-background-subtraction-by-the-rolling-ball-method-the-histogram_fig3_319985119" class="external-link">here</a>.</p>
<div id="exercise-7-rolling-ball-background-intensity" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-7-rolling-ball-background-intensity" class="callout-inner">
<h3 class="callout-title">Exercise 7: Rolling ball background intensity</h3>
<div class="callout-content">
<p>Look at the <a href="https://scikit-image.org/docs/stable/auto_examples/segmentation/plot_rolling_ball.html" class="external-link">scikit-image
documentation</a> on the rolling ball filter. Load the example image <a href="https://scikit-image.org/docs/stable/api/skimage.data.html#skimage.data.coins" class="external-link">skimage.data.coins</a>
and display:</p>
<ul>
<li>the original image</li>
<li>image with a rolling ball of radius 100 applied</li>
<li>image with a rolling ball of radius 50 applied</li>
<li>the image with the radius=50 rolling ball subtracted from it</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Compute time can be found using Python’s datetime library:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">from</span> skimage.data <span class="im">import</span> coins</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="im">from</span> skimage.restoration <span class="im">import</span> rolling_ball</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>image <span class="op">=</span> coins()</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>plt.imshow(image, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>plt.title(<span class="st">'Original'</span>)</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>rolling_ball_100 <span class="op">=</span> rolling_ball(image, radius<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>plt.imshow(rolling_ball_100, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>plt.title(<span class="st">'Rolling ball, r=100'</span>)</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>rolling_ball_50 <span class="op">=</span> rolling_ball(image, radius<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>plt.imshow(rolling_ball_50, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>plt.title(<span class="st">'Rolling ball, r=50'</span>)</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>plt.imshow(image <span class="op">-</span> rolling_ball_50)</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>plt.title(<span class="st">'Original - rolling ball r50'</span>)</span></code></pre>
</div>
<figure><img src="fig/2_2_rolling_ball.jpg" alt="Rolling ball" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="dogs-and-logs">Dogs and logs<a class="anchor" aria-label="anchor" href="#dogs-and-logs"></a>
</h2>
<hr class="half-width">
<p>Difference of Gaussian (DoG) and Laplacian of Gaussian (LoG) are
algorithms that build on the Gaussian filter.</p>
<p>In a <a href="https://scikit-image.org/docs/stable/api/skimage.filters.html#skimage.filters.difference_of_gaussians" class="external-link">Difference
of Gaussian</a>, two Gaussian filters are taken of the image, each with
a different sigma value. The larger filter is then subtracted from the
first to give an image where features are effectively highlighted by an
area of high contrast.</p>
<p>In a Laplacian of Gaussian, a Gaussian-filtered image is supplied to
a <a href="https://scikit-image.org/docs/stable/api/skimage.filters.html#skimage.filters.laplace" class="external-link">Laplace</a>
filter. This eliminates the need to manually select two sigma values as
with Difference of Gaussian.</p>
<div id="exercise-8-dogs-and-logs" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-8-dogs-and-logs" class="callout-inner">
<h3 class="callout-title">Exercise 8: Dogs and logs</h3>
<div class="callout-content">
<p>Load a frame from the second channel of <a href="https://scikit-image.org/docs/stable/api/skimage.data.html#skimage.data.cells3d" class="external-link">skimage.data.cells3d()</a>
again:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">from</span> skimage.data <span class="im">import</span> cells3d</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>image <span class="op">=</span> cells3d()[<span class="dv">30</span>, <span class="dv">1</span>, :, :]</span></code></pre>
</div>
<p>Display a figure of:</p>
<ul>
<li>The original image</li>
<li>Image with a Difference of Gaussians applied with sigma values 2 and
4</li>
<li>Image with a Laplacian of Gaussians applied. Note that the Laplace
filter linked above does not perform the Gaussian filter for you, so you
will need to pass the image through <code>gaussian()</code> first.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="im">from</span> skimage.data <span class="im">import</span> cells3d</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="im">from</span> skimage.filters <span class="im">import</span> gaussian, difference_of_gaussians, laplace</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>image <span class="op">=</span> cells3d()[<span class="dv">30</span>, <span class="dv">1</span>, :, :]</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">12</span>))</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>plt.imshow(image)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>plt.title(<span class="st">'Original'</span>)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>plt.imshow(difference_of_gaussians(image, <span class="dv">1</span>, <span class="dv">2</span>), cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>plt.title(<span class="st">'Difference of Gaussians'</span>)</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>plt.imshow(laplace(gaussian(image, sigma<span class="op">=</span><span class="dv">2</span>)), cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>plt.title(<span class="st">'Laplacian of Gaussian'</span>)</span></code></pre>
</div>
<figure><img src="fig/2_3_dogs_and_logs.jpg" alt="Dogs and logs" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="exercise-9-choosing-a-filter" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="exercise-9-choosing-a-filter" class="callout-inner">
<h3 class="callout-title">Exercise 9: Choosing a filter</h3>
<div class="callout-content">
<p>Look at the images you produced in exercises 6 and 8, and select one
to use in subsequent chapters for thresholding and segmentation!</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>There are many ways of smoothing an image</li>
<li>Different methods will perform better in different situations</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-03-thresholding-and-segmentation"><p>Content from <a href="03-thresholding-and-segmentation.html">Thresholding and Segmentation</a></p>
<hr>
<p>Last updated on 2025-03-18 |

        <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/edit/main/episodes/03-thresholding-and-segmentation.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I isolate features of interest in my image?</li>
<li>How can I uniquely label features once I’ve found them?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Apply various thresholds an image</li>
<li>Quantify features of interest in an image</li>
<li>Demonstrate how to deal with edge cases like features stuck
together</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>These exercises will make use of the image you decided to use in
exercise 9.</p>
<section><h2 class="section-heading" id="thresholding">Thresholding<a class="anchor" aria-label="anchor" href="#thresholding"></a>
</h2>
<hr class="half-width">
<p>Thresholding consists of converting an image into a binary form where
each pixel value is either 0 or 1 depending on whether it exceeds a
given threshold.</p>
<p>We can <strong>binarise</strong> an image with a given threshold by
applying the <code>&gt;</code> operator to it. It’s common practice to
smooth the image first, e.g. with a Gaussian filter:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">from</span> skimage.data <span class="im">import</span> cells3d</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="im">from</span> skimage.filters <span class="im">import</span> gaussian</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>smoothed_image <span class="op">=</span> gaussian(cells3d()[<span class="dv">30</span>, <span class="dv">1</span>, :, :])</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="bu">print</span>(image.<span class="bu">min</span>(), image.<span class="bu">max</span>(), image.dtype)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>plt.imshow(image, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>plt.title(<span class="st">'Gaussian filter'</span>)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>binary_image <span class="op">=</span> image <span class="op">&gt;</span> <span class="fl">0.12</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>plt.imshow(binary_image)</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>plt.title(<span class="st">'Threshold &gt; 0.12'</span>)</span></code></pre>
</div>
<figure><img src="fig/3_1_threshold.jpg" alt="Threshold" class="figure mx-auto d-block"></figure><p>Applying a set number to an image as a threshold is simple, but it’s
not ideal having to guess an appropriate threshold until we get a
sensible one. Looking at the histogram helps, but still requires some
manual interpretation and human subjectivity:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>plt.hist(image.flatten(), bins<span class="op">=</span><span class="dv">256</span>)</span></code></pre>
</div>
<figure><img src="fig/3_2_histogram.jpg" alt="Histogram" class="figure mx-auto d-block"></figure><p>Fortunately, there are several algorithms for automatically
determining an appropriate threshold based on the image’s histogram.
<strong>Global</strong> thresholds work on the entire image, whereas
<strong>local</strong> thresholds work on a window around each pixel -
for the moment, we will only discuss global filters.</p>
<div id="exercise-10-thresholds" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-10-thresholds" class="callout-inner">
<h3 class="callout-title">Exercise 10: Thresholds</h3>
<div class="callout-content">
<p>Look at the <a href="https://scikit-image.org/docs/stable/api/skimage.filters.html" class="external-link">skimage
filter docs</a> and find each of the following threshold algorithms:</p>
<ul>
<li>Otsu threshold</li>
<li>Triangle threshold</li>
</ul>
<p>Try running each of these algorithms on your smoothed image from
exercise 9, and use the resulting threshold to binarise the image. How
do the results differ?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>We can display the two threshold algorithms in a figure:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">from</span> skimage.filters <span class="im">import</span> threshold_otsu, threshold_triangle</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>plt.imshow(smoothed_image)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>plt.title(<span class="st">'Gaussian filter'</span>)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co"># Otsu threshold</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>threshold <span class="op">=</span> threshold_otsu(image)</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>plt.imshow(image <span class="op">&gt;</span> threshold)</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>plt.title(<span class="st">'Otsu threshold'</span>)</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co"># Triangle threshold</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>threshold <span class="op">=</span> threshold_triangle(image)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>plt.imshow(image <span class="op">&gt;</span> threshold)</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>plt.title(<span class="st">'Triangle threshold'</span>)</span></code></pre>
</div>
<figure><img src="fig/3_3_otsu_triangle.jpg" alt="Otsu and Triangle thresholds" class="figure mx-auto d-block"></figure><p>Which threshold performs better can depend on the image you have.
Otsu thresholding is less sensitive so foreground objects are more
likely to be incomplete or have holes in them, whereas triangle
thresholding has a greater tendency for close foreground objects to
become stuck together.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="cleaning-up">Cleaning up<a class="anchor" aria-label="anchor" href="#cleaning-up"></a>
</h2>
<hr class="half-width">
<p>Once we have a binary image, we may still need to clean it up
further. There may still be extraneous pixels and other bits and pieces
left around the regions of interest, or there may be holes in a shape
that you need to be solid.</p>
<div id="exercise-11-erosion-dilation-opening-and-closing" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-11-erosion-dilation-opening-and-closing" class="callout-inner">
<h3 class="callout-title">Exercise 11: Erosion, dilation, opening and closing</h3>
<div class="callout-content">
<p>Look at the <a href="https://scikit-image.org/docs/stable/api/skimage.morphology.html" class="external-link">skimage
morphology docs</a>. Select one of your binary images from exercise 10
and apply each of the following algorithms to the image:</p>
<ul>
<li>Binary erosion</li>
<li>Binary dilation</li>
<li>Binary opening</li>
<li>Binary closing</li>
</ul>
<p>Note: each of the algorithms above will require a kernel or
footprint. For each of these, use a disc-shaped kernel of radius 2:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">from</span> skimage.morphology <span class="im">import</span> disk</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>kernel <span class="op">=</span> disk(<span class="dv">2</span>)</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">from</span> skimage.morphology <span class="im">import</span> binary_erosion, binary_dilation, binary_opening, binary_closing</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="im">from</span> skimage.morphology <span class="im">import</span> disk</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>kernel <span class="op">=</span> disk(<span class="dv">2</span>)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">12</span>))</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co"># your binary image from exercise 10</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>plt.imshow(binary_image, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>plt.title(<span class="st">'Binary image'</span>)</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co"># erosion</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>plt.imshow(binary_erosion(binary_image, footprint<span class="op">=</span>kernel), cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>plt.title(<span class="st">'Erosion'</span>)</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co"># dilation</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>plt.imshow(binary_dilation(binary_image, footprint<span class="op">=</span>kernel), cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>plt.title(<span class="st">'Dilation'</span>)</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co"># opening</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>plt.imshow(binary_opening(binary_image, footprint<span class="op">=</span>kernel), cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>plt.title(<span class="st">'Opening'</span>)</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="co"># closing</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>plt.imshow(binary_closing(binary_image, footprint<span class="op">=</span>kernel), cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>plt.title(<span class="st">'Closing'</span>)</span></code></pre>
</div>
<figure><img src="fig/3_4_transforms.jpg" alt="Image transformations" class="figure mx-auto d-block"></figure><p>Eroding has the effect of shrinking all foreground features. Dilating
has the opposite effect, potentially resulting in foreground features
becoming stuck together.</p>
<p>Opening an image is an erosion followed by a dilation. If your image
is grainy with many small artifacts, these will be removed.</p>
<p>Closing is the opposite - dilation followed by erosion. This will
have the effect of filling in any holes in your foreground features.</p>
</div>
</div>
</div>
</div>
<p>If there are still holes in your binary image, there is also a
function in scipy.ndimage that can fix this:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">from</span> scipy.ndimage <span class="im">import</span> binary_fill_holes</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>fill_holes <span class="op">=</span> binary_fill_holes(binary_image)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>plt.imshow(fill_holes)</span></code></pre>
</div>
<figure><img src="fig/3_5_fill_holes.jpg" alt="Binary fill holes" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="labelling">Labelling<a class="anchor" aria-label="anchor" href="#labelling"></a>
</h2>
<hr class="half-width">
<p>In some situations, it may be necessary to distinguish between
individual features, e.g. if counting cell nuclei. For this, it is
necessary to isolate or <strong>label</strong> individual separated
objects in the foreground:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="im">from</span> skimage.morphology <span class="im">import</span> label</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>labels <span class="op">=</span> label(fill_holes)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>plt.imshow(labels, cmap<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>plt.colorbar()</span></code></pre>
</div>
<p>This will result in an image similar to the binary image supplied,
but instead of just 1s, each feature will have a unique number assigned
to all of its pixels. Displaying this with a colour scale will
effectively colour-code each one:</p>
<figure><img src="fig/3_6_labels.jpg" alt="Image labelling" class="figure mx-auto d-block"></figure><p>However, we can see that the process is not perfect, as nuclei that
are stuck together have been marked as the same feature. In the
exercises below, we will explore how to solve this.</p>
</section><section><h2 class="section-heading" id="watershed-transform">Watershed transform<a class="anchor" aria-label="anchor" href="#watershed-transform"></a>
</h2>
<hr class="half-width">
<p>Several transforming or segmentation operations exist for solving
situations like the one above with touching objects.</p>
<p>This transformation requires a few preparation steps. First, we need
a <strong>distance transform</strong> of the binary image, where each
foreground pixel’s value is its Euclidean distance to the background.
skimage doesn’t have a function for this, but scipy does:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">from</span> scipy.ndimage <span class="im">import</span> distance_transform_edt</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>dt <span class="op">=</span> distance_transform_edt(fill_holes)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>plt.imshow(dt)</span></code></pre>
</div>
<figure><img src="fig/3_7_distance_transform.jpg" alt="Distance transform" class="figure mx-auto d-block"></figure><p>Next, we need the coordinates of all <strong>local maxima</strong>,
i.e. locations that are furthest away from the background. This requires
a kernel/footprint, which in this example is a square kernel of 7x7:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="im">from</span> skimage.feature <span class="im">import</span> peak_local_max</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>coords <span class="op">=</span> peak_local_max(dt, labels<span class="op">=</span>fill_holes)</span></code></pre>
</div>
<p>This gives us a list of coordinates, so we need to convert this back
into an labelled image of maxima. This will be mostly blank with an
individually labelled dot representing each one:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> zeros</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>mask <span class="op">=</span> zeros(dt.shape, dtype<span class="op">=</span><span class="bu">bool</span>)  <span class="co"># create a blank image the same size as the original</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>mask[<span class="bu">tuple</span>(coords.T)] <span class="op">=</span> <span class="va">True</span>  <span class="co"># create a foreground pixel at each coordinate</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>markers <span class="op">=</span> label(mask)  <span class="co"># uniquely label them</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>plt.imshow(markers, cmap<span class="op">=</span><span class="st">'viridis'</span>)</span></code></pre>
</div>
<figure><img src="fig/3_8_maxima.png" alt="Local maxima" class="figure mx-auto d-block"></figure><p>Note the <code>.T</code> to transpose the maxima coordinates.</p>
<p>At this point depending on your image, you may get clusters of peaks
close together rather than one clean, distinct peak per feature. This is
especially likely if your features are not circular. Applied to the
final watershed step below, this will result in features being split
when they shouldn’t be. This can be resolved in several ways:</p>
<div class="section level3">
<h3 id="smoothing-the-distance-transform-first">Smoothing the distance transform first<a class="anchor" aria-label="anchor" href="#smoothing-the-distance-transform-first"></a>
</h3>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>coords <span class="op">=</span> peak_local_max(gaussian(dt, sigma<span class="op">=</span><span class="dv">4</span>), labels<span class="op">=</span>fill_holes)</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="applying-a-larger-footprint-to-peak_local_max">Applying a larger footprint to peak_local_max<a class="anchor" aria-label="anchor" href="#applying-a-larger-footprint-to-peak_local_max"></a>
</h3>
<p>There are a few different ways to do this - all we need to do is
create a kernel of a cerain shape and size, and pass it to
peak_local_max:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># numpy</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> ones</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>coords <span class="op">=</span> peak_local_max(dt, footprint<span class="op">=</span>ones((<span class="dv">7</span>,<span class="dv">7</span>)), labels<span class="op">=</span>fill_holes)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co"># skimage &lt; 0.25.0</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>coords <span class="op">=</span> peak_local_max(dt, footprint<span class="op">=</span>square(<span class="dv">7</span>), labels<span class="op">=</span>fill_holes)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co"># skimage &gt;= 0.25.0</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>coords <span class="op">=</span> peak_local_max(dt, footprint<span class="op">=</span>footprint_rectangle((<span class="dv">7</span>, <span class="dv">7</span>)), labels<span class="op">=</span>fill_holes)</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="providing-a-min_distance-argument-to-peak_local_max">Providing a <code>min_distance</code> argument to
peak_local_max<a class="anchor" aria-label="anchor" href="#providing-a-min_distance-argument-to-peak_local_max"></a>
</h3>
<p>This will prevent the function from identifying peaks too close
together:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>coords <span class="op">=</span> peak_local_max(dt, min_distance<span class="op">=</span><span class="dv">10</span>, labels<span class="op">=</span>fill_holes)</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="masked-watershed">Masked watershed<a class="anchor" aria-label="anchor" href="#masked-watershed"></a>
</h3>
<p>Now that we have identified some peaks, we can now put the distance
transform together with the local peaks to do the transform:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="im">from</span> skimage.segmentation <span class="im">import</span> watershed</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>watershed_transform <span class="op">=</span> watershed(<span class="op">-</span>dt, markers)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>plt.imshow(watershed_transform, cmap<span class="op">=</span><span class="st">'viridis'</span>)</span></code></pre>
</div>
<figure><img src="fig/3_9_watershed.jpg" alt="Watershed segmentation" class="figure mx-auto d-block"></figure><p>Note the <code>-</code> in front of the distance transform. This
effectively converts it from a map of peaks to a map of troughs. We need
to do this because of the <a href="https://bioimagebook.github.io/chapters/2-processing/6-transforms/transforms.html#the-watershed-transform" class="external-link">way
watershed transforms work</a>.</p>
<p>The result of the watershed transform above does not indicate the
shape of the nuclei. Rather, the algorithm effectively decides which
nucleus each pixel of the image most closely corresponds to. We can
generate a more meaningful image by multiplying the watershed and the
binary image together to create a <strong>masked watershed</strong>:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>masked_watershed <span class="op">=</span> watershed_transform <span class="op">*</span> binary_image</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>plt.imshow(masked_watershed, cmap<span class="op">=</span><span class="st">'viridis'</span>)</span></code></pre>
</div>
<figure><img src="fig/3_10_masked_watershed.png" alt="Masked watershed" class="figure mx-auto d-block"></figure><p>It’s also possible to do the last two steps in one by providing
<code>mask=some_binary_image</code> to
skimage.segmentation.watershed.</p>
<div id="exercise-12-image-segmentation" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-12-image-segmentation" class="callout-inner">
<h3 class="callout-title">Exercise 12: Image segmentation</h3>
<div class="callout-content">
<ul>
<li>Load up one of your cleaned up images from exercise 11 and run
<code>skimage.morphology.label</code> on the foreground features</li>
<li>How many features did skimage find? (hint: try flattening your
labelled image and printing the result to the screen)</li>
<li>Perform a watershed transform on your binary image as above. Try
displaying the result of each stage of the transform.</li>
<li>How many features are identified now, after watershed
transformation?</li>
<li>Does the watershed transformation work perfectly?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Labelling applies a unique number to each feature. This means that if
we apply thresholding and labelling to the image, we can flatten the
result and cast it to a set to find all the unique label numbers
present, and find the highest numbered label to get the number of
features:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="im">from</span> skimage.data <span class="im">import</span> cells3d</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="im">from</span> skimage.filters <span class="im">import</span> gaussian, threshold_otsu</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="im">from</span> skimage.morphology <span class="im">import</span> label</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co"># whatever your chosen cleaned up image is</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>plt.imshow(binary_image)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>plt.title(<span class="st">'Cleaned up image'</span>)</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co"># labelled</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>labels <span class="op">=</span> label(binary_image)</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>plt.imshow(labels, cmap<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>plt.title(<span class="st">'Labelled'</span>)</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>flat <span class="op">=</span> labels.flatten()</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">set</span>(flat))</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Features found:'</span>, <span class="bu">max</span>(flat))</span></code></pre>
</div>
<p>However, we see from the intermediate images that multiple touching
nuclei are treated as a single feature.</p>
<p>Here is an example of using distance and watershed transforms to
segment touching objects:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="im">from</span> skimage.feature <span class="im">import</span> peak_local_max</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="im">from</span> skimage.segmentation <span class="im">import</span> watershed</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="im">from</span> scipy.ndimage <span class="im">import</span> distance_transform_edt</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>dt <span class="op">=</span> distance_transform_edt(binary_image)</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>plt.imshow(dt)</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>plt.title(<span class="st">'Distance transform'</span>)</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>coords <span class="op">=</span> peak_local_max(dt, min_distance<span class="op">=</span><span class="dv">10</span>, labels<span class="op">=</span>binary_image)</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>mask <span class="op">=</span> numpy.zeros(dt.shape, dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>mask[<span class="bu">tuple</span>(coords.T)] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>plt.imshow(mask, cmap<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>plt.title(<span class="st">'Markers'</span>)</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>markers <span class="op">=</span> label(mask)</span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>labels <span class="op">=</span> watershed(<span class="op">-</span>dt, markers, mask<span class="op">=</span>binary_image)</span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>plt.imshow(labels, cmap<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Features found:'</span>, <span class="bu">max</span>(labels.flatten()))</span></code></pre>
</div>
<p>This will segment more correctly, however the accuracy of the process
still depends on the inputs supplied. Irregular objects with holes in
them will be harder to segment than even, solid, rounded shapes.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Thresholding, labelling and feature isolation are all forms of
segmentation</li>
<li>Different thresholding algorithms can perform differently in
different situations</li>
<li>Quantitative image analysis often requires us to individually label
features</li>
<li>Processing such as watershed transforms can solve cases where
features of interest are very close or stuck together</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-04-measurements"><p>Content from <a href="04-measurements.html">Measurements</a></p>
<hr>
<p>Last updated on 2025-03-18 |

        <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/edit/main/episodes/04-measurements.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I make useful measurements in my image?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Find the mean pixel intensity in each nucleus</li>
<li>Find the area of each nucleus</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Having isolated individual nuclei in the example image in the
previous chapter, we can make some observations about the image
features. The exercises here will require:</p>
<ul>
<li>Your masked watershed transformation from the previous chapter</li>
<li>Your original smoothed image from exercise 9</li>
</ul>
<div class="section level3">
<h3 id="processing-one-nucleus-at-a-time">Processing one nucleus at a time<a class="anchor" aria-label="anchor" href="#processing-one-nucleus-at-a-time"></a>
</h3>
<p>Remember that each nucleus is labelled with a unique number, so we
use masking to select a single nucleus. We can construct a binary mask
from a labelled image using numpy’s <a href="https://numpy.org/doc/stable/reference/generated/numpy.where.html" class="external-link">where
function</a>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> where</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>nucleus_1 <span class="op">=</span> where(masked_watershed <span class="op">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>nucleus_2 <span class="op">=</span> where(masked_watershed <span class="op">==</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre>
</div>
<p>Here, each pixel will be set to either 1 or 0 depending on whether
its value matches the label we’re looking for, effectively creating a
<strong>binary mask</strong> for each nucleus.</p>
<div id="exercise-13-quantifying-intensities" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-13-quantifying-intensities" class="callout-inner">
<h3 class="callout-title">Exercise 13: Quantifying intensities</h3>
<div class="callout-content">
<p>For each labelled nucleus:</p>
<ul>
<li>Construct a binary mask matching the label number</li>
<li>Use this to isolate the individual nucleus out of your
<strong>original smoothed image</strong>
<ul>
<li>Hint: try looking at the <a href="https://numpy.org/doc/stable/reference/generated/numpy.where.html" class="external-link"><code>numpy.where</code></a>
docs to see the different ways it can be used.</li>
</ul>
</li>
<li>Find the mean pixel value for the nucleus</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>First, we need to know how many features we’re looping over. We can
get that from the numbers that the labelling process provides - if your
labelled image contains the labels 1, 2 and 3, then you have 3
features.</p>
<p>Next, we need to generate a mask for that feature using
<code>numpy.where</code>, that will allow us to mask out the original
image - in this case, either a corresponding pixel value from the
original image or <code>None</code>. We can then take the result of
that, select all pixels that are not <code>None</code> and use
<code>numpy.mean</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>labels <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">set</span>(masked_watershed.flatten()))</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> labels[:<span class="dv">6</span>]:  <span class="co"># just showing the first 6</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    mask <span class="op">=</span> numpy.where(masked_watershed <span class="op">==</span> i, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    nucleus <span class="op">=</span> numpy.where(mask <span class="op">==</span> <span class="dv">1</span>, image, <span class="dv">0</span>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, i <span class="op">+</span> <span class="dv">1</span>)  <span class="co"># subplot counts from 1 rather than 0</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    plt.imshow(nucleus)</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>    pixels <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> nucleus.flatten() <span class="cf">if</span> p]  <span class="co"># remove the background pixels</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Feature </span><span class="sc">%i</span><span class="st">:'</span> <span class="op">%</span> i, numpy.mean(pixels))</span></code></pre>
</div>
<figure><img src="fig/4_1_mean_intensities.png" alt="Mean intensities" class="figure mx-auto d-block"></figure><p>A few notes:</p>
<ul>
<li>Note how the first feature labelled as <code>0</code> corresponds to
the background</li>
<li>Remember that in <code>subplot</code>, we need to offset the subplot
number by +1, since it counts from 1</li>
<li>In the first <code>numpy.where</code> above, we supply two single
numbers, 1 and 0, giving us a binary mask. In the next one, we provide
an n-dimensional array instead, causing it to instead select the value
of the corresponding pixel.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Binary multiplication and <code>numpy.where</code> are powerful ways
of combining images and masks</li>
<li>The numbers assigned during labelling can be used to select and
process one feature at a time</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div></section><section id="aio-05-napari"><p>Content from <a href="05-napari.html">Introduction to Napari</a></p>
<hr>
<p>Last updated on 2025-03-18 |

        <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/edit/main/episodes/05-napari.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I view images and metadata in Napari?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Open and explore some images and compare the process of doing the
same process in Python</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="starting-napari">Starting Napari<a class="anchor" aria-label="anchor" href="#starting-napari"></a>
</h2>
<hr class="half-width">
<p>With Napari installed and its Conda environment active, run:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">napari</span></span></code></pre>
</div>
<p>This will start up Napari in a new window. This may take about a
minute, especially the first time.</p>
</section><section><h2 class="section-heading" id="looking-around">Looking around<a class="anchor" aria-label="anchor" href="#looking-around"></a>
</h2>
<hr class="half-width">
<p>In the ‘File’ menu, go to ‘Open Sample -&gt; napari builtins -&gt;
Cells (3D+2Ch)’. Looking at the sidebar, Napari has opened two
<strong>layers</strong> - ‘membrane’ and ‘nuclei’. At the top of the
sidebar there are options for displaying layers in different colours and
opacity, and the eye symbol on the layer can be checked or unchecked to
show/hide it:</p>
<figure><img src="fig/5_1_layers.jpg" alt="Napari layers" class="figure mx-auto d-block"></figure><p>Napari uses layers to represent each stage of processing an image -
we run tools to create new processed layers based off of a previous one.
In this example, the image consists of two channels, each of which has
been loaded as a layer.</p>
<p>In the case of z-stack or time series images such as this one, there
is also a slider at the bottom for scrolling through the layers.</p>
<div id="exercise-14-napari-tools" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-14-napari-tools" class="callout-inner">
<h3 class="callout-title">Exercise 14: Napari tools</h3>
<div class="callout-content">
<p>With ‘Cells (3D + 2Ch)’ open, go to ‘Tools -&gt; Filtering / Noise
Removal’ and look at the options available. What are these options? What
happens if you select one and try running it on a layer?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>The options here consist of smoothing filters, several of which will
be familiar from previous chapters. In some cases there are multiple
versions of a filter (e.g. there are three Gaussian filters), each of
which uses a different Python library.</p>
<p>Selecting one of these gives a sidebar letting us choose how to run
it, including which layer to use, plus any extra parameters it may take,
such as sigma values for Gaussian filters:</p>
<figure><img src="fig/5_2_gaussian_filter_controls.jpg" alt="Gaussian filter controls" class="figure mx-auto d-block"></figure><figure><img src="fig/5_3_gaussian_filter.jpg" alt="Gaussian filter" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="loading-real-world-images">Loading real-world images<a class="anchor" aria-label="anchor" href="#loading-real-world-images"></a>
</h2>
<hr class="half-width">
<p>The example images work nicely with Napari, but sometimes it may be
more difficult to coax Napari into loading an image correctly. In
‘File’, select ‘Open File(s)…’ and load up
FluorescentCells_3channel.tif. Doing this, we find the results aren’t
quite what we expect - the three channels have been loaded as if they’re
a z-stack.</p>
<p>Fortunately, Napari includes a Python console that gives us very
fine-grained control of the user interface, and will let us load this
image correctly. In the bottom left, use the ’&gt;_’ button to open a
terminal. This activates a Python session where Napari is represented as
an object called <code>viewer</code>:</p>
<figure><img src="fig/5_4_python_console.png" alt="Napari Python console" class="figure mx-auto d-block"></figure><ul>
<li>All the loaded layers are in a list called
<code>viewer.layers</code>
</li>
<li>Within a layer, the image data is an attribute called
<code>data</code>
</li>
</ul>
<p>In this console, we can create new layers with
<code>viewer.add_image</code>. First, let’s look at the image’s
shape:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">from</span> skimage.io <span class="im">import</span> imread</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>image <span class="op">=</span> imread(<span class="st">'path/to/FluorescentCells_3channel.tif'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>image.shape</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># returns: (512, 512, 3)</span></span></code></pre>
</div>
<p>From this, we can see that the colour channels are the third axis.
Using this, We can now load each channel as a new layer:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>viewer.add_image(image[:, :, <span class="dv">0</span>], name<span class="op">=</span><span class="st">'FluorescentCells_ch0'</span>, colormap<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>viewer.add_image(image[:, :, <span class="dv">1</span>], name<span class="op">=</span><span class="st">'FluorescentCells_ch1'</span>, colormap<span class="op">=</span><span class="st">'green'</span>, blending<span class="op">=</span><span class="st">'additive'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>viewer.add_image(image[:, :, <span class="dv">2</span>], name<span class="op">=</span><span class="st">'FluorescentCells_ch2'</span>, colormap<span class="op">=</span><span class="st">'blue'</span>, blending<span class="op">=</span><span class="st">'additive'</span>)</span></code></pre>
</div>
<p>The <code>blending='additive'</code> option prevents layers on top
from obscuring layers below it so that we can view multiple layers at
once. We also use <code>colormap</code> to colour the layers so we can
distinguish them from each other.</p>
<p><code>viewer.add_image</code> is also able to load all these layers
in one if we tell it which axis represents the colour channels:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>viewer.add_image(image, name<span class="op">=</span><span class="st">'FluorescentCells'</span>, channel_axis<span class="op">=</span><span class="dv">2</span>)</span></code></pre>
</div>
<div id="exercise-15-real-world-images" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-15-real-world-images" class="callout-inner">
<h3 class="callout-title">Exercise 15: Real world images</h3>
<div class="callout-content">
<ul>
<li>Go to ‘File’ -&gt; ‘Open File(s)…’ and load the image
‘confocal-series_zstack.tif’. How does it look? Can you view each
channel simultaneously?</li>
<li>Now try loading the same image in the console as above, looking at
the image’s shape and passing the channel axis to
<code>viewer_add_image</code>. axis looks like the channels. How has the
fourth axis been represented?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Loading the image from the menu, we can see some results but it’s all
in one layer and the channel axis is represented as a slider, meaning we
can’t view the two at the same time.</p>
<p>As an alternative, we can load the image in the Python console:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>image <span class="op">=</span> imread(<span class="st">'path/to/confocal-series_zstack.tif'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>image.shape</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co"># returns: (25, 2, 400, 400)</span></span></code></pre>
</div>
<p>The second number, i.e. <code>image.shape[1]</code> looks like the
channel axis. We can then provide this when loading the image:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>viewer.add_image(image, name<span class="op">=</span><span class="st">'FluorescentCells'</span>, channel_axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre>
</div>
<p>Napari will load the image as two coloured layers, with the Z axis
represented via the slider at the bottom.</p>
</div>
</div>
</div>
</div>
<div id="exercise-16-image-segmentation-in-the-napari-console" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-16-image-segmentation-in-the-napari-console" class="callout-inner">
<h3 class="callout-title">Exercise 16: Image segmentation in the Napari console</h3>
<div class="callout-content">
<p>This exercise will put together everything that has been covered in
previous chapters, and apply the same steps in the Napari console.</p>
<p>Look at the ‘nuclei’ layer of ‘Cells (3D + 2Ch)’. In the Python
console, try doing the same smoothing, binarisation, segmentation and
labelling that you performed throughout exercises 6-12, except
displaying each step as a new layer in the Napari viewer.</p>
<p>Remember that instead of <code>matplotlib.pyplot.imshow()</code>,
you’ll need to use <code>viewer.add_image()</code></p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="im">import</span> skimage</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>image <span class="op">=</span> skimage.data.cells3d()</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>image.shape</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co"># returns: (60, 2, 256, 256)</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>frame <span class="op">=</span> image[<span class="dv">30</span>, <span class="dv">1</span>, :, :]</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>smoothed_image <span class="op">=</span> skimage.filters.gaussian(frame, sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>viewer.add_image(smoothed_image, name<span class="op">=</span><span class="st">'smoothed'</span>)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>threshold <span class="op">=</span> skimage.filters.threshold_otsu(smoothed_image)</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>binary_image <span class="op">=</span> smoothed_image <span class="op">&gt;</span> threshold</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>viewer.add_image(binary_image, name<span class="op">=</span><span class="st">'Otsu threshold'</span>)</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="im">import</span> scipy.ndimage</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>fill_holes <span class="op">=</span> scipy.ndimage.binary_fill_holes(binary_image)</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>viewer.add_image(fill_holes, name<span class="op">=</span><span class="st">'fill_holes'</span>)</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>distance_transform <span class="op">=</span> scipy.ndimage.distance_transform_edt(fill_holes)</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>viewer.add_image(distance_transform, name<span class="op">=</span><span class="st">'distance_transform'</span>)</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>coords <span class="op">=</span> skimage.feature.peak_local_max(skimage.filters.gaussian(distance_transform, sigma<span class="op">=</span><span class="dv">4</span>), labels<span class="op">=</span>fill_holes)</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="im">import</span> numpy</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>mask <span class="op">=</span> numpy.zeros(distance_transform.shape, dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>mask[<span class="bu">tuple</span>(coords.T)] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>markers <span class="op">=</span> skimage.morphology.label(mask)</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>viewer.add_image(markers, name<span class="op">=</span><span class="st">'peaks'</span>)</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>watershed_transform <span class="op">=</span> skimage.segmentation.watershed(<span class="op">-</span>distance_transform, markers)</span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>viewer.add_image(watershed_transform, name<span class="op">=</span><span class="st">'watershed'</span>)</span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>masked_watershed <span class="op">=</span> watershed_transform <span class="op">*</span> fill_holes</span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>viewer.add_image(masked_watershed, name<span class="op">=</span><span class="st">'masked_watershed'</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="image-segmentation-with-napari-tools">Image segmentation with Napari tools<a class="anchor" aria-label="anchor" href="#image-segmentation-with-napari-tools"></a>
</h2>
<hr class="half-width">
<p>Aside from running analyses in the Python console, Napari has a
variety of processing steps that can be browsed under ‘Tools’.</p>
<p>For example, we can go to ‘Open Sample’ -&gt; ‘napari builtins’ and
-&gt; ‘Binary Blobs’. Browse the tools available and run:</p>
<ul>
<li>Otsu threshold</li>
<li>Split touching objects (nsbatwm). Try experimenting with different
sigma values until you get some good cell separations.</li>
<li>Connected component labelling (scikit-image, nsbatwm)</li>
</ul>
<p>Note: The Otsu threshold shouldn’t be required since the test image
is already a binary, but the ‘Split touching objects’ Napari tool isn’t
able to recognise the original as a binary image. This is because Napari
expects the values to be 0/1, whereas the test image uses the values
True/False. Thresholding the image again converts it to the right
type.</p>
<div id="exercise-17-exporting-code" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-17-exporting-code" class="callout-inner">
<h3 class="callout-title">Exercise 17: Exporting code</h3>
<div class="callout-content">
<p>This exercise will see how the processing that we have built up with
Napari tools can be exported back to Python code that we can then check
into version control and integrate into a workflow to help automate the
processing of many images.</p>
<p>Under ‘Plugins’, open the Napari Assistant and find the ‘Export
Python code’ tool. Use this to generate a Python script that will
perform the processing that you just performed above on the Binary Blobs
image. Does the script look usable immediately without modification?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>There are several options to export in different ways, including to a
Jupyter notebook. The simplest way is probably to copy to clipboard -
this can be pasted into a text editor or IDE:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">from</span> skimage.io <span class="im">import</span> imread</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="im">import</span> napari_segment_blobs_and_things_with_membranes <span class="im">as</span> nsbatwm  <span class="co"># version 0.3.6</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="im">import</span> napari</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="cf">if</span> <span class="st">'viewer'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    viewer <span class="op">=</span> napari.Viewer()</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>image0_bb <span class="op">=</span> viewer.layers[<span class="st">'binary_blobs'</span>].data</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co"># threshold otsu</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>image1_to <span class="op">=</span> nsbatwm.threshold_otsu(image0_bb)</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>viewer.add_labels(image1_to, name<span class="op">=</span><span class="st">'Result of threshold_otsu'</span>)</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co"># split touching objects</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>image2_sto <span class="op">=</span> nsbatwm.split_touching_objects(image1_to, <span class="fl">5.6</span>)</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>viewer.add_labels(image2_sto, name<span class="op">=</span><span class="st">'Result of split_touching_objects'</span>)</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co"># connected component labeling</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>image3_ccl <span class="op">=</span> nsbatwm.connected_component_labeling(image2_sto, <span class="va">False</span>)</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>viewer.add_labels(image3_ccl, name<span class="op">=</span><span class="st">'Result of connected_component_labeling'</span>)</span></code></pre>
</div>
<p>Looking at it, we can see that it’s not immediately usable but it’s
pretty close. Exported scripts do not make any reference to what image
file was loaded, and there is no code at the end for writing the
resuults to a file, so this is what you would need to add to get it to
produce tangible output.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Napari works with layers, each of which represents an image
channel</li>
<li>Napari doesn’t always know how to load a multi-channel image from
the GUI</li>
<li>We can use the Python console to perform custom operations that
can’t be done in the GUI</li>
<li>Most operations we performed earlier in Python can also be done in
Napari, either graphically or in the terminal</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/" class="external-link">Source</a></p>
				<p><a href="https://github.com/IGC-Advanced-Imaging-Resource/image-analysis-python-napari/blob/main/LICENSE/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://IGC-Advanced-Imaging-Resource.github.io/image-analysis-python-napari/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "image, python, napari, scikit-image",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://IGC-Advanced-Imaging-Resource.github.io/image-analysis-python-napari/aio.html",
  "identifier": "https://IGC-Advanced-Imaging-Resource.github.io/image-analysis-python-napari/aio.html",
  "dateCreated": "2023-09-19",
  "dateModified": "2025-03-18",
  "datePublished": "2025-03-18"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

